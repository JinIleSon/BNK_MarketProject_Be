<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mypage_main</title>
    <!-- ëª¨ë‹¬ ì „ìš© ìŠ¤íƒ€ì¼ -->
  <style>
    /* ì „ì²´ ì˜¤ë²„ë ˆì´ */
    .modal-backdrop {
      position: fixed; inset: 0;
      background: rgba(0,0,0,.45);
      display: none;
      z-index: 9998;
    }
    .modal-backdrop.is-open { display: block; }

    /* ëª¨ë‹¬ ë°•ìŠ¤ */
    .modal {
      position: fixed; inset: 0;
      display: none;
      place-items: center;
      z-index: 9999;
    }
    .modal.is-open { display: grid; }

    .modal-dialog {
      width: 860px; max-width: calc(100% - 40px);
      background: #fff; border-radius: 10px;
      box-shadow: 0 20px 60px rgba(0,0,0,.25);
      overflow: hidden;
      font-family: sans-serif;
    }
    /* ìƒë‹¨ ë°” */
    .modal-header {
      background: #000000; color:#fff;
      padding: 4px 16px; font-weight: 700;
      display: flex; align-items: center; justify-content: space-between;
    }
    .modal-header .date { font-weight: 400; opacity:.9; margin-left: 12px; }
    .modal-close {
      appearance: none; border: 0; background: transparent;
      color:#fff; font-size: 20px; cursor: pointer; padding: 4px 8px;
    }
    /* ë³¸ë¬¸ */
    .modal-body { padding: 0; }
    .section {
      padding: 14px 18px;
    }
    .section-title {
      font-weight: 700; margin-bottom: 8px;
    }
    table.order-info {
      width: 100%; border-collapse: collapse; font-size: 14px;
    }
    .order-info th, .order-info td {
      border-bottom: 1px solid #eee; padding: 10px; vertical-align: middle;
    }
    .order-info thead th {
      background: #dedede; color:#fff; font-size: 12px; height: 38px;
    }
    .thumb { width: 120px; }
    .price {
      font-size: 18px; font-weight: 800; margin-top: 8px;
    }
    .right { text-align: right; white-space: nowrap; }
    /* ë°°ì†¡ì •ë³´ í‘œ */
    .kv { width: 100%; border-collapse: collapse; font-size: 14px; }
    .kv td { border-bottom: 1px solid #eee; padding: 10px; padding-left: 13px; }
    .kv td:first-child {height: 45px; background-color: #f2f2f2; text-align: center; width: 130px; }
    /* ì ‘ê·¼ì„± í¬ì»¤ìŠ¤ íŠ¸ë©ìš© */
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0; }

    /* ===== ë¦¬ë·° ëª¨ë‹¬ ë³´ê°• ===== */
    .review-form { padding: 18px; }
    .review-grid { width:100%; border-collapse: collapse; font-size:14px; }
    .review-grid td { border-bottom:1px solid #eee; padding:10px; }
    .review-grid td:first-child { width:120px; text-align:center; background:#f2f2f2; }
    .review-title {
      border:none; border-bottom:1px solid gray; width:270px; outline:none;
      height:34px; padding:6px 8px; box-sizing:border-box;
    }
    .review-textarea {
      width:100%; resize:none; outline:none; padding:8px; box-sizing:border-box; height:160px;
    }
    .review-actions { display:flex; justify-content:center; gap:10px; margin-top:16px; }
    .char-count { font-size:12px; color:#666; text-align:right; margin-top:6px; }

    /* ë³„ì : ê¸°ë³¸ì€ ë¹ˆ ë³„(â˜†), ì„ íƒ/í˜¸ë²„ ì‹œ ì±„ì›€(â˜…) */
    .rating { display:inline-flex; flex-direction: row-reverse; gap:4px; }
    .rating input { position:absolute; opacity:0; }
    .rating label { cursor:pointer; font-size:22px; line-height:1; }

    /* ê¸°ë³¸ì€ ë¹ˆ ë³„ */
    .rating label::before { content: 'â˜†'; }

    /* ì„ íƒëœ ê°’ê³¼ ê·¸ ì™¼ìª½(ì‹œê°ì  ê¸°ì¤€)ê¹Œì§€ ì±„ì›€ */
    .rating input:checked ~ label::before { content: 'â˜…'; }

    /* ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ ë¯¸ë¦¬ë³´ê¸°(í˜¸ë²„ êµ¬ê°„ê¹Œì§€ ì±„ì›€) */
    .rating label:hover::before,
    .rating label:hover ~ label::before { content: 'â˜…'; }


    /* ===== ìµœê·¼ ì£¼ë¬¸ë‚´ì—­ í…Œì´ë¸” ===== */
    #orderListTable {
        width: 900px;
        border-collapse: collapse;
        text-align: center;
        border-top: 1px solid #000;
        font-family: 'Noto Sans KR', sans-serif;
        background-color: #fff;
    }

    #orderListTable th {
        background-color: #dedede;
        font-size: 12px;
        color: #fff;
        font-weight: 800;
        height: 40px;
        border-bottom: 1px solid #ccc;
    }

    #orderListTable td {
        border-bottom: 1px solid #dddddd;
        vertical-align: top;
        padding: 10px 5px;
    }

    /* ===== ìƒí’ˆì •ë³´ ì˜ì—­ ===== */
    .order-item {
        display: flex;
        align-items: flex-start;
        gap: 15px;
        margin-bottom: 15px;
        border-bottom: 1px solid #f1f1f1;
        padding-bottom: 10px;
    }

    .order-item img {
        width: 90px;
        height: 90px;
        object-fit: cover;
        border: 1px solid #eee;
        border-radius: 6px;
    }

    .order-item .info {
        flex: 1;
        text-align: left;
    }

    .order-item .info .seller {
        color: gray;
        font-size: 13px;
        margin-bottom: 4px;
    }

    .order-item .info .name {
        font-weight: 700;
        font-size: 15px;
        color: #000;
        margin-bottom: 3px;
    }

    .order-item .info .qty {
        font-size: 13px;
        color: #555;
        margin-bottom: 3px;
    }

    .order-item .info .price {
        font-size: 17px;
        font-weight: 800;
        color: #000;
    }

    /* ===== ë²„íŠ¼ ì˜ì—­ ===== */
    button.review-btn,
    button.exchange-btn,
    button.return-btn,
    button.confirm-purchase {
        width: 90px;
        height: 32px;
        font-size: 12px;
        cursor: pointer;
        border-radius: 2px;
        transition: all 0.2s;
    }

    /* ê²€ì • ë²„íŠ¼ (ìƒí’ˆí‰ì“°ê¸°, êµ¬ë§¤í™•ì •) */
    button.review-btn,
    button.confirm-purchase {
        background-color: #000;
        color: #fff;
        border: none;
    }

    button.review-btn:hover,
    button.confirm-purchase:hover {
        opacity: 0.85;
    }

    /* í°ìƒ‰ ë²„íŠ¼ (êµí™˜ì‹ ì²­, ë°˜í’ˆì‹ ì²­) */
    button.exchange-btn,
    button.return-btn {
        background-color: #fff;
        border: 1px solid #ddd;
        color: #000;
    }

    button.exchange-btn:hover,
    button.return-btn:hover {
        background-color: #f9f9f9;
    }

    /* ===== ìƒíƒœ í‘œì‹œ ===== */
    .order-status {
        color: #000000;
        font-weight: 600;
    }

    /* ===== "ìµœê·¼ì£¼ë¬¸ë‚´ì—­" ìƒë‹¨ ì˜ì—­ ===== */
    .order-section-title {
        font-weight: 800;
        font-size: 15px;
        margin-right: auto;
        margin-bottom: 10px;
    }

    .more-link {
        font-size: 13px;
        color: #000;
        text-decoration: none;
    }

    .more-link:hover {
        text-decoration: underline;
    }

  </style>
</head>
<body>
<div id="userData" th:data-user-id="${userId}" style="display:none;"></div>
    <main>
        <div th:replace="~{main/header.html}"></div>
        <div style="background-color: #f6f5f5; border-bottom: 1px solid #dddddd;">
            <div style="display: flex; justify-content: center; align-items: center;">
                <div style="width:1270px; font-size:15px; height:70px; display: flex; align-items: center; ">
                    <div style="font-weight: 800; margin-left:73px;">ë‚˜ì˜ ì‡¼í•‘ ì •ë³´</div>
                    <div style="display: flex; margin-left:auto; margin-right:40px;">
                        <div style="width:70px;border-right:1px solid #dddddd; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <div style="margin-bottom:8px;">ì£¼ë¬¸</div>
                            <div><span th:text="${ordersAmount}"></span></div>
                        </div>
                        <div style="width:70px; border-right:1px solid #dddddd; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <div style="margin-bottom:8px;">ì¿ í°</div>
                            <div><span th:text="${couponCount}"></span></div>
                        </div>
                        <div style="width:70px;border-right:1px solid #dddddd; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <div style="margin-bottom:8px;">í¬ì¸íŠ¸</div>
                            <div><span th:text="${#numbers.formatInteger(balance, 3, 'COMMA')} + 'P'">0P</span></div>
                        </div>
                        <div style="width:70px;display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <div style="margin-bottom:8px;">ë¬¸ì˜</div>
                            <div><span th:text="${count}"></span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div style="display: flex; justify-content: center; align-items: center;">
            <div style="width:1270px; font-size:15px; display: flex;">
                <div style=" width:200px; padding-left:70px; padding-top:30px; border-right:1px solid #dddddd;">
                    <div style="margin-bottom:15px;"><a th:href="@{/mypage/mypage/allorder}">ì „ì²´ì£¼ë¬¸ë‚´ì—­</a></div>
                    <div style="margin-bottom:15px;"><a th:href="@{/mypage/mypage/point}">í¬ì¸íŠ¸ë‚´ì—­</a></div>
                    <div style="margin-bottom:15px;"><a th:href="@{/mypage/mypage/coupon}">ì¿ í°</a></div>
                    <div style="margin-bottom:15px;"><a th:href="@{/mypage/mypage/review}">ë‚˜ì˜ë¦¬ë·°</a></div>
                    <div style="margin-bottom:15px;"><a th:href="@{/mypage/mypage/ask}">ë¬¸ì˜í•˜ê¸°</a></div>
                    <div><a th:href="@{/mypage/mypage/setup}">ë‚˜ì˜ì„¤ì •</a></div>
                </div>
                <div style="width: 100%;">
                    <div style="margin-top:30px; display: flex; justify-content: center;">
                        <div>
                          <img th:src="@{/images/mypage_mainBanner2.jpg}" alt="" style="width:400px;">
                          <div style="font-size:10px;">Image by <a href="https://www.freepik.com" target="_blank" style="color:inherit; text-decoration:none;">Freepik</a></div>
                        </div>
                    </div>
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; margin-top:40px;">
                        <div style="display: flex; margin-top:30px;">
                            <div style="font-weight: 800; margin-right:750px; margin-bottom:5px;">ìµœê·¼ì£¼ë¬¸ë‚´ì—­</div>
                            <div style="margin-left:auto;"><a th:href="@{/mypage/mypage/allorder}">ë”ë³´ê¸° ></a></div>
                        </div>

                        <table id="orderListTable" style="text-align:center; border-collapse:collapse; border-top:1px solid; width:900px;">
                            <tr style="background-color:#dedede; font-size:12px; color:white; font-weight:800; height:40px;">
                                <th style="width:120px;">ë‚ ì§œ</th>
                                <th style="width:500px;">ìƒí’ˆì •ë³´</th>
                                <th style="width:160px;">ì‹ ì²­</th>
                                <th style="width:100px;">ìƒíƒœ</th>
                                <th style="width:120px;">í™•ì¸</th>
                            </tr>

                            <!-- ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ì„ ë•Œ -->
                            <tr th:if="${#lists.isEmpty(recentOrders)}" style="border-bottom:1px solid #dddddd; height:180px;">
                                <td colspan="5" style="padding:50px; color:#888;">ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td>
                            </tr>

                            <!-- âœ… ì£¼ë¬¸ë³„ ë°˜ë³µ -->
                            <th:block th:each="o : ${recentOrders}">
                                <tr style="border-bottom:1px solid #dddddd;">

                                    <!-- ì£¼ë¬¸ì¼ì -->
                                    <td th:text="${o.created_at}" style="vertical-align:top; padding-top:20px; white-space:nowrap;"></td>

                                    <!-- ìƒí’ˆì •ë³´ -->
                                    <td style="text-align:left; padding:15px 10px;">
                                        <th:block th:each="item, itemStat : ${o.orderItems}">
                                            <div style="display:flex; align-items:flex-start; gap:15px; margin-bottom:15px; border-bottom:1px solid #f1f1f1; padding-bottom:10px;">

                                                <!-- ì´ë¯¸ì§€ -->
                                                <div>
                                                    <img th:if="${item.url != null}"
                                                         th:src="@{'/' + ${item.url}}"
                                                         onerror="this.onerror=null; this.src='/NICHIYA/images/no_image.jpg'"
                                                         alt="ìƒí’ˆ ì´ë¯¸ì§€"
                                                         style="width:90px; height:90px; object-fit:cover; border:1px solid #eee; border-radius:6px;">
                                                    <img th:if="${item.url == null}"
                                                         src="/NICHIYA/images/no_image.jpg"
                                                         alt="ìƒí’ˆ ì´ë¯¸ì§€"
                                                         style="width:90px; height:90px; object-fit:cover; border:1px solid #eee; border-radius:6px;">
                                                </div>

                                                <!-- ìƒí’ˆ ì •ë³´ -->
                                                <div style="flex:1;">
                                                    <div th:if="${itemStat.index == 0}" style="margin-bottom:5px; color:#888; font-size:13px;">
                                                        ì£¼ë¬¸ë²ˆí˜¸ : <a href="#" class="order-link" th:attr="data-order-code=${o.order_code}">[[${o.order_code}]]</a>
                                                    </div>
                                                    <div style="margin-bottom:5px; color:#888; font-size:13px;">
                                                        íŒë§¤ì :
                                                        <a href="#"
                                                           class="seller-link"
                                                           th:data-seller-name="${item.company_name}"

                                                           th:data-seller-rep="${o.seller_rep}"
                                                           th:data-seller-tel="${o.seller_tel}"
                                                           th:data-seller-email="${o.seller_email}"
                                                           th:data-seller-bizno="${o.seller_bizno}"
                                                           th:data-seller-addr="${o.seller_addr}"
                                                           th:data-seller-mailnum="${o.seller_mailnum}">
                                                            [[${item.company_name}]]
                                                        </a>
                                                    </div>
                                                    <div style="font-weight:600; color:#222;">
                                                        <a th:href="@{'/product/views?id=' + ${item.products_id}}"
                                                           class="product-link"
                                                           target="_blank">
                                                            [[${item.productName}]]
                                                        </a>
                                                    </div>
                                                    <div style="font-size:13px; color:#666;">ìˆ˜ëŸ‰: <span th:text="${item.quantity}"></span>ê°œ</div>
                                                    <div style="font-size:15px; font-weight:700; color:#000;" th:text="${#numbers.formatInteger(item.price, 0, 'COMMA')} + 'ì›'"></div>
                                                </div>
                                            </div>
                                        </th:block>
                                    </td>

                                    <!-- ì‹ ì²­ -->
                                    <!-- ì‹ ì²­ -->
                                    <td style="vertical-align:top; padding:15px 0;">
                                        <th:block th:each="item : ${o.orderItems}">
                                            <div style="display:flex; flex-direction:column; align-items:center; gap:6px; margin-bottom:10px;">

                                                <!-- âœ… ìƒí’ˆí‰ì“°ê¸° -->
                                                <button class="review-btn"
                                                        th:attr="data-product-id=${item.products_id},data-product-name=${item.productName}"
                                                        style="background-color:#000; color:#fff; border:none; width:90px; height:32px; font-size:12px; cursor:pointer;">
                                                    ìƒí’ˆí‰ì“°ê¸°
                                                </button>

                                                <!-- âœ… êµí™˜ì‹ ì²­ -->
                                                <button class="exchange-btn"
                                                        th:attr="data-order-item-id=${item.id},
                                                    data-product-id=${item.products_id},
                 data-product-name=${item.productName},
                 data-product-img=|/NICHIYA/${item.url}|"
                                                        style="background-color:#fff; color:#000; border:1px solid #ddd; width:90px; height:32px; font-size:12px; cursor:pointer;">
                                                    êµí™˜ì‹ ì²­
                                                </button>

                                                <!-- âœ… ë°˜í’ˆì‹ ì²­ -->
                                                <button class="return-btn"
                                                        th:attr="data-order-item-id=${item.id},
                 data-product-name=${item.productName},
                 data-product-img=|/NICHIYA/${item.url}|"
                                                        style="background-color:#fff; color:#000; border:1px solid #ddd; width:90px; height:32px; font-size:12px; cursor:pointer;">
                                                    ë°˜í’ˆì‹ ì²­
                                                </button>
                                            </div>
                                        </th:block>
                                    </td>


                                    <!-- ìƒíƒœ -->
                                    <td th:text="${o.status}" style="vertical-align:top; padding-top:20px; font-weight:600; color:#000000;"></td>

                                    <!-- í™•ì¸ -->
                                    <td style="vertical-align:top; padding-top:20px;">
                                        <button class="confirm-purchase"
                                                th:attr="data-order-id=${o.order_code}"
                                                style="background-color:#000; color:#fff; width:100px; height:34px; border:none; cursor:pointer;">
                                            êµ¬ë§¤í™•ì •
                                        </button>
                                    </td>
                                </tr>
                            </th:block>
                        </table>

                    </div>
                    <div style="margin-top:30px; display: flex; justify-content: center;">
                        <div>
                          <img th:src="@{/images/mypage_mainBanner3.jpg}" alt="" style="width:400px;">
                          <div style="font-size:10px;">Image by <a href="https://www.freepik.com" target="_blank" style="color:inherit; text-decoration:none;">Freepik</a></div>
                        </div>
                    </div>
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; margin-top:40px;">
                        <div style="display: flex; margin-top:30px;">
                            <div style="font-weight: 800; margin-right:736px; margin-bottom:5px;">í¬ì¸íŠ¸ì ë¦½ë‚´ì—­</div>
                            <div style="margin-left:auto;"><a th:href="@{/mypage/mypage/point}">ë”ë³´ê¸° ></a></div>
                        </div>
                        <table style="text-align: center; border-collapse: collapse;border-top:1px solid; width:900px;">
                            <tr style="background-color: #dedede; font-size:12px; color:white; font-weight: 800; height:40px;">
                                <th style="width:120px;">ë‚ ì§œ</th>
                                <th style="">êµ¬ë¶„</th>
                                <th style="">ì£¼ë¬¸ë²ˆí˜¸</th>
                                <th style="">ì ë¦½ê¸ˆì•¡</th>
                                <th style="">ë¹„ê³ </th>
                                <th style="width:125px;">ìœ íš¨ê¸°ê°„</th>
                            </tr>
                            <tr style="border-bottom: 1px solid #dddddd; height:65px;"
                                th:each="point, stat: ${pageResponseUserPointDTO.dtoList}"
                                th:if="${stat.index} < 5">
                                <td><span
                                        th:text="${#strings.substring(point.created_at, 0, 10)}"></span></td>
                                <td style=""><span
                                        th:text="${point.change_amount >= 0 ? 'ì ë¦½' : 'ì‚¬ìš©'}"></span></td>
                                <td style="letter-spacing: -1px;"
                                    th:text="${point.description == 'ìƒí’ˆ êµ¬ë§¤ ì™„ë£Œ'
                                      ? (10121211362L
                                         + pageResponseUserPointDTO.dtoList.subList(0, stat.index + 1).?[description == 'ìƒí’ˆ êµ¬ë§¤ ì™„ë£Œ'].size()
                                         - 1)
                                      : '-'}">2022121001</td>
                                <td><span
                                        th:text="${point.change_amount}"></span></td>
                                <td><span
                                        th:text="${point.description}"></span></td>
                                <td><span th:text="${ T(java.time.LocalDate)
                                                     .parse(#strings.substring(point.created_at, 0, 10))
                                                     .plusYears(2)
                                                     .format(T(java.time.format.DateTimeFormatter).ofPattern('yyyy-MM-dd')) }">
                                  </span></td>
                            </tr>

                        </table>
                    </div>
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; margin-top:40px;">
                        <div style="display: flex; margin-top:30px;">
                            <div style="font-weight: 800; margin-right:797px; margin-bottom:5px;">ìƒí’ˆí‰</div>
                            <div style="margin-left:auto;"><a th:href="@{/mypage/mypage/review}">ë”ë³´ê¸° ></a></div>
                        </div>
                        <table style="text-align: center; border-collapse: collapse;border-top:1px solid; width:900px;" class="review-table">
                            <tr style="background-color: #dedede; font-size:12px; color:white; font-weight: 800; height:40px;">
                                <th style="width:70px;">ë²ˆí˜¸</th>
                                <th style="width:170px;">ìƒí’ˆëª…</th>
                                <th style="width: 400px;">ë‚´ìš©</th>
                                <th style="width:120px;">í‰ì </th>
                                <th style="">ì‘ì„±ì¼</th>
                            </tr>
                            <tr style="border-bottom: 1px solid #dddddd; height:65px;"
                                th:each="review, stat: ${pageResponseReviewDTO.dtoList}"
                                th:if="${stat.index} < 5">
                                <td th:text="${T(java.lang.Math).min(5, stat.size) - stat.index}">5</td>
                                <td style="" class="col-name"><span th:text="${review.product_code}"></span> / <a th:href="@{/product/views(id=${review.pid})}">[[${review.product_name}]]</a></td>
                                <td style="" class="col-content"><span th:text="${review.content}"></span></td>
                                <td><span th:text="${review.rating == 5 ? 'â˜…â˜…â˜…â˜…â˜…' :
                                (review.rating == 4 ? 'â˜…â˜…â˜…â˜…â˜†' :
                                (review.rating == 3 ? 'â˜…â˜…â˜…â˜†â˜†' :
                                (review.rating == 2 ? 'â˜…â˜…â˜†â˜†â˜†' :
                                (review.rating == 1 ? 'â˜…â˜†â˜†â˜†â˜†' : 'â˜†â˜†â˜†â˜†â˜†'))))}"></span></td>
                                <td><span th:text="${#temporals.format(review.created_at, 'yyyy-MM-dd')}"></span></td>
                            </tr>
                        </table>
                        <style>
                            /* í‘œê°€ ì…€ ë„ˆë¹„ë¥¼ ì§€ì¼œì„œ ì¤„ë°”ê¿ˆë˜ë„ë¡ */
                            .review-table { table-layout: fixed; }

                            /* ìƒí’ˆëª…/ë‚´ìš© ì¹¸: ë‹¨ì–´ ê¸°ì¤€ ì¤„ë°”ê¿ˆ(ìŠ¤í˜ì´ìŠ¤ ìš°ì„ ) */
                            .col-name, .col-content {
                                white-space: normal;        /* ì¤„ë°”ê¿ˆ í—ˆìš© */
                                word-break: keep-all;       /* ë‹¨ì–´ ì¤‘ê°„ ë‹¨ì ˆ ê¸ˆì§€(ìŠ¤í˜ì´ìŠ¤ì—ì„œë§Œ ì¤„ë°”ê¿ˆ) */
                                overflow-wrap: break-word;  /* ë„ˆë¬´ ê¸´ í† í°(ì½”ë“œ ë“±)ì¼ ë•Œë§Œ ì˜ˆì™¸ì ìœ¼ë¡œ ì¤„ë°”ê¿ˆ */
                                line-height: 1.4;
                            }
                            /* ìƒí’ˆëª… ë§í¬ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
                            .review-table a {
                                color: #a0a0a0;                 /* ê¸°ë³¸ ê¸€ììƒ‰ */
                                text-decoration: none;       /* ë°‘ì¤„ ì œê±° */
                                transition: color 0.2s, transform 0.2s; /* ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ */
                            }

                            /* hover ì‹œ ì‹œê°ì  í”¼ë“œë°± */
                            .review-table a:hover {
                                color: #222;              /* íŒŒë€ìƒ‰ìœ¼ë¡œ ê°•ì¡° */
                                text-decoration: underline;  /* ë°‘ì¤„ í‘œì‹œ */
                                transform: translateY(-1px); /* ì‚´ì§ ìœ„ë¡œ ì˜¬ë¼ê°€ê²Œ */
                            }
                        </style>
                    </div>
                    <div style="margin-top:30px; display: flex; justify-content: center;">
                        <div>
                          <img th:src="@{/images/mypage_mainBanner4.jpg}" alt="" style="width:400px;">
                          <div style="font-size:10px; padding-left:15px;">Image by <a href="https://www.freepik.com" target="_blank" style="color:inherit; text-decoration:none;">Freepik</a></div>
                        </div>
                    </div>
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; margin-top:40px;">
                        <div style="display: flex; margin-top:30px;">
                            <div style="font-weight: 800; margin-right:782px; margin-bottom:5px;">ë¬¸ì˜ë‚´ì—­</div>
                            <div style="margin-left:auto;"><a th:href="@{/mypage/mypage/ask}">ë”ë³´ê¸° ></a></div>
                        </div>
                        <table style="text-align: center; border-collapse: collapse;border-top:1px solid; width:900px;">
                            <tr style="background-color: #dedede; font-size:12px; color:white; font-weight: 800; height:40px;"
                                >
                                <th style="width:60px;"
                                    >ë²ˆí˜¸</th>
                                <th style="width:120px;">1ì°¨ ìœ í˜•</th>
                                <th style="width:87px;">2ì°¨ ìœ í˜•</th>
                                <th style="">ì œëª©</th>
                                <th style="">ì‘ì„±ì¼</th>
                                <th style="width:90px;">ìƒíƒœ</th>
                            </tr>
                            <tr style="border-bottom: 1px solid #dddddd; height:65px;"
                                th:each="inquiry, stat: ${pageResponseInquiryDTO.dtoList}"
                                th:if="${stat.index} < 5">
                                <td th:text="${T(java.lang.Math).min(5, stat.size) - stat.index}">1</td>
                                <td style=""
                                    th:text="${inquiry.board_type2 == 'member' ? 'íšŒì›' :
                        (inquiry.board_type2 == 'event' ? 'ì¿ í° / ì´ë²¤íŠ¸' :
                        (inquiry.board_type2 == 'pay' ? 'ì£¼ë¬¸ / ê²°ì œ' :
                        (inquiry.board_type2 == 'delivery' ? 'ë°°ì†¡' :
                        (inquiry.board_type2 == 'cancel' ? 'ì·¨ì†Œ / ë°˜í’ˆ / êµí™˜' :
                        (inquiry.board_type2 == 'trip' ? 'ì—¬í–‰ / ìˆ™ë°• / í•­ê³µ' :
                        (inquiry.board_type2 == 'safe' ? 'ì•ˆì „ê±°ë˜' : ''))))))}">ê³ ê°ì„¼í„°</td>
                                <td style="letter-spacing: -1px;"
                                    th:text="${inquiry.board_type3 == 'signup' ? 'ê°€ì…' :
                        (inquiry.board_type3 == 'withdraw' ? 'íƒˆí‡´' :
                        (inquiry.board_type3 == 'account' ? 'íšŒì›ì •ë³´' :
                        (inquiry.board_type3 == 'login' ? 'ë¡œê·¸ì¸' :
                        (inquiry.board_type3 == 'couponissue' ? 'ì¿ í°ë°œê¸‰' :
                        (inquiry.board_type3 == 'couponuse' ? 'ì¿ í°ì‚¬ìš©' :
                        (inquiry.board_type3 == 'eventjoin' ? 'ì´ë²¤íŠ¸ì°¸ì—¬' :
                        (inquiry.board_type3 == 'winnercheck' ? 'ë‹¹ì²¨í™•ì¸' :
                        (inquiry.board_type3 == 'orderguide' ? 'ì£¼ë¬¸ë°©ë²•' :
                        (inquiry.board_type3 == 'paymentmethod' ? 'ê²°ì œìˆ˜ë‹¨' :
                        (inquiry.board_type3 == 'paymenterror' ? 'ê²°ì œì˜¤ë¥˜' :
                        (inquiry.board_type3 == 'receipt' ? 'ì˜ìˆ˜ì¦/ì¦ë¹™' :
                        (inquiry.board_type3 == 'tracking' ? 'ë°°ì†¡ì¡°íšŒ' :
                        (inquiry.board_type3 == 'deliverytime' ? 'ë°°ì†¡ê¸°ê°„' :
                        (inquiry.board_type3 == 'deliveryfee' ? 'ë°°ì†¡ë¹„' :
                        (inquiry.board_type3 == 'globalshipping' ? 'í•´ì™¸ë°°ì†¡' :
                        (inquiry.board_type3 == 'ordercancel' ? 'ì£¼ë¬¸ì·¨ì†Œ' :
                        (inquiry.board_type3 == 'refund' ? 'ë°˜í’ˆ' :
                        (inquiry.board_type3 == 'exchange' ? 'êµí™˜' :
                        (inquiry.board_type3 == 'refundprocess' ? 'í™˜ë¶ˆì²˜ë¦¬' :
                        (inquiry.board_type3 == 'reservation' ? 'ì˜ˆì•½' :
                        (inquiry.board_type3 == 'payment' ? 'ê²°ì œ' :
                        (inquiry.board_type3 == 'changecancel' ? 'ë³€ê²½/ì·¨ì†Œ' :
                        (inquiry.board_type3 == 'guide' ? 'ì´ìš©ì•ˆë‚´' :
                        (inquiry.board_type3 == 'security' ? 'ë³´ì•ˆê³µì§€' :
                        (inquiry.board_type3 == 'alert' ? 'ì‚¬ê¸°ì£¼ì˜' :
                        (inquiry.board_type3 == 'safepayment' ? 'ì•ˆì „ê²°ì œ' :
                        (inquiry.board_type3 == 'privacy' ? 'ê°œì¸ì •ë³´ë³´í˜¸' : '')))))))))))))))))))))))))))}">ì£¼ë¬¸ / ê²°ì œ</td>
                                <td>[[${inquiry.title}]]</td>
                                <td th:text="${#temporals.format(inquiry.createdAt, 'yyyy-MM-dd')}">2022-12-12</td>
                                <td style="color:gray;"
                                    th:text="${inquiry.look == 0 ? 'ê²€í†  ì¤‘' : 'ë‹µë³€ì™„ë£Œ'}"
                                    th:style="${inquiry.look == 0 ? 'color:black;' : 'color:#4f9cd3;'}">ê²€í† ì¤‘</td>
                            </tr>
                        </table>
                    </div>
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; margin-top:40px;">
                        <div style="display: flex; margin-top:30px;">
                            <div style="font-weight: 800; margin-right:843px; margin-bottom:5px;">ë‚˜ì˜ì„¤ì •</div>
                        </div>
                        <div style="padding:20px; border: 1px solid #dddddd;background-color: #dce6f2; height:150px; width:900px; display: grid; grid-template-columns: repeat(3, 300px);">
                          <div style="display:flex; flex-direction: column; border-right:1px solid gray;">
                            <div style="display: flex;">
                              <div style="margin-right: 20px; margin-bottom:20px;">ê¸°ë³¸ë°°ì†¡ì§€ ì„¤ì •</div>
                              <div><a th:href="@{/mypage/mypage/setup}" style="font-weight: 800;">ë³€ê²½</a></div>
                            </div>
                            <div style="width:250px;font-size: 15px; color:gray; margin-bottom:6px;"><span th:text="${userDTO.address}"></span></div>
                            <div style="font-size: 15px; color:gray;"><span th:text="${userDTO.detailAddress}"></span></div>
                          </div>
                          <div style="display:flex; flex-direction: column; border-right:1px solid gray; padding-left:23px;">
                            <div style="display: flex;">
                              <div style="margin-right: 20px; margin-bottom:20px;">Email ì„¤ì •</div>
                              <div><a th:href="@{/mypage/mypage/setup}" style="font-weight: 800;">ë³€ê²½</a></div>
                            </div>
                            <div style="font-size: 15px; color:gray; margin-bottom:6px;"><span th:text="${userDTO.email}"></span></div>
                            <div style="font-size: 15px; color:gray;">( ìµœì¢…ìˆ˜ì •ì¼ <span th:text="${#temporals.format(userDTO.created_at, 'yyyy-MM-dd')}"></span> )</div>
                          </div>
                          <div style="display:flex; flex-direction: column; padding-left:23px;">
                            <div style="display: flex;">
                              <div style="margin-right: 20px; margin-bottom:20px;">íœ´ëŒ€í° ì„¤ì •</div>
                              <div><a th:href="@{/mypage/mypage/setup}" style="font-weight: 800;">ë³€ê²½</a></div>
                            </div>
                            <div style="font-size: 15px; color:gray; margin-bottom:6px;"><span th:text="${userDTO.phone}"></span></div>
                            <div style="font-size: 15px; color:gray;">( ìµœì¢…ìˆ˜ì •ì¼ <span th:text="${#temporals.format(userDTO.created_at, 'yyyy-MM-dd')}"></span> )</div>
                          </div>
                        </div>
                    </div>
                    <div style="margin-bottom:50px;"></div>
                </div>
                
            </div>
        </div>
        <div style="margin-top:100px;"></div>
        <div th:replace="~{main/footer.html}"></div>
    </main>
    <!-- ì£¼ë¬¸ ìƒì„¸ ë§ˆì´í˜ì´ì§€_ë©”ì¸#2-->
    <!-- ===== ì£¼ë¬¸ ìƒì„¸ ëª¨ë‹¬ ë§ˆí¬ì—… ===== -->
  <div class="modal-backdrop" id="orderModalBackdrop" aria-hidden="true"></div>
  <div class="modal" id="orderModal" role="dialog" aria-modal="true" aria-labelledby="orderModalTitle" aria-hidden="true">
    <div class="modal-dialog" tabindex="-1" style="border-radius: 0px !important;">
      <div class="modal-header" style="border-radius: 0px !important;">
        <div>
          <span id="orderModalTitle">ì£¼ë¬¸ìƒì„¸</span>
          <span class="date" id="orderDate">2022-12-13</span>
        </div>
        <button class="modal-close" type="button" aria-label="ë‹«ê¸°" id="orderModalClose">âœ•</button>
      </div>

      <div class="modal-body">
        <!-- ì£¼ë¬¸ì •ë³´ -->
        <div class="section" style="padding-top:16px;">
          <div class="section-title">ì£¼ë¬¸ì •ë³´</div>
          <table class="order-info" style="border-top:1px solid; text-align: center; vertical-align: middle;">
            <thead >
              <tr style="background-color: #dedede !important;">
                <th style="width:120px;">ë‚ ì§œ</th>
                <th style="width:400px">ìƒí’ˆì •ë³´</th>
                <th style="width:165px;">ê²°ì œê¸ˆì•¡</th>
                <th style="">ìƒíƒœ</th>
              </tr>
            </thead>
            <tbody>
              <tr style="border-bottom: 1px solid #dddddd; height:180px; ">
                    <td style="">
                        2022-12-13
                    </td>
                    <td style="text-align: left; padding-left:10px;">
                        <div style="display: flex; align-items: center;">
                            <div>
                                <img th:src="@{/images/product_list1.jpg}" alt="" style="height:121px;">
                            </div>
                            <div style="padding-left:30px; letter-spacing: -1px;">
                                <div style="margin-bottom:5px;"><a href="#" class="order-link" data-order-id="1012211341" style="color:gray;">ì£¼ë¬¸ë²ˆí˜¸ : 1012211341</a></div>
                                <div style="margin-bottom:5px;"><a href="#" style="color:gray;">(ì£¼) ìƒí˜¸ëª…</a></div>
                                <div style="margin-bottom:5px;"><a href="#" style="color:gray;">ìƒí’ˆëª…</a></div>
                                <div style="margin-bottom:7px;">ìˆ˜ëŸ‰ : 1ê°œ</div>
                                <div style="margin-bottom:5px; font-size: 20px; font-weight: 800;">34,000ì›</div>
                            </div>
                        </div>
                    </td>
                    <td style="">
                        <div style=" display: flex; margin-bottom: 5px;">
                            <div>íŒë§¤ê°€</div>
                            <div style="margin-left: auto;">34,000ì›</div>
                        </div>
                        <div style=" display: flex; margin-bottom: 28px;">
                            <div>í• ì¸</div>
                            <div style="margin-left: auto;">-3,000ì›</div>
                        </div>
                        <div style=" display: flex;">
                            <div>ê²°ì œê¸ˆì•¡</div>
                            <div style="margin-left: auto; font-weight: 800;">31,000ì›</div>
                        </div>
                    </td>
                    <td>
                        ë°°ì†¡ì™„ë£Œ
                    </td>
                </tr>
            </tbody>
          </table>
        </div>

        <!-- ë°°ì†¡ì •ë³´ -->
        <div class="section" style="margin-bottom:45px; padding-top:2px;">
          <div class="section-title">ë°°ì†¡ì •ë³´</div>
          <table class="kv">
            <tr style="border-top:1px solid #eee;"><td>ì´ë¦„</td><td id="shipName">í™ê¸¸ë™</td></tr>
            <tr><td>ì—°ë½ì²˜</td><td id="shipPhone">010-1234-1001</td></tr>
            <tr><td>ì£¼ì†Œ</td><td id="shipAddr">[210**] ë¶€ì‚°ê´‘ì—­ì‹œ ë¶€**êµ¬ **ë™ 121 10ì¸µ 1004í˜¸</td></tr>
            <tr><td>ë°°ì†¡ìš”ì²­ì‚¬í•­</td><td id="shipMemo">ì—†ìŒ</td></tr>
          </table>
        </div>
      </div>
      <button class="sr-only" id="modalSentinel">ë</button>
    </div>
  </div>

  <!-- ===== ì£¼ë¬¸ ìƒì„¸ ëª¨ë‹¬ ë™ì‘ ìŠ¤í¬ë¦½íŠ¸ ===== -->
    <script>
        const ctxPath = window.location.pathname.startsWith('/NICHIYA') ? '/NICHIYA' : '';

        const modal = document.getElementById('orderModal');
        const backdrop = document.getElementById('orderModalBackdrop');
        const btnClose = document.getElementById('orderModalClose');
        const sentinel = document.getElementById('modalSentinel');

        function setText(id, value) {
            const el = document.getElementById(id);
            if (el) el.textContent = value;
        }

        function openOrderModal(data) {
            console.log("âœ… [openOrderModal] ì‹¤í–‰ë¨ â€” ë°ì´í„°:", data);

            setText('orderDate', data.created_at || '-');
            setText('shipName',  data.recipient || data.user_name || '-');
            setText('shipPhone', data.delivery_phone || '-');
            setText('shipAddr',  data.address || '-');
            setText('shipMemo',  data.delivery_status || 'ì—†ìŒ');



            modal.classList.add('is-open');
            backdrop.classList.add('is-open');
            modal.querySelector('.modal-dialog').focus();
            document.body.style.overflow = 'hidden';
        }

        function closeOrderModal() {
            console.log("ğŸŸ  [closeOrderModal] ëª¨ë‹¬ ë‹«í˜");
            modal.classList.remove('is-open');
            backdrop.classList.remove('is-open');
            document.body.style.overflow = '';
        }

        // âœ… ì£¼ë¬¸ë²ˆí˜¸ í´ë¦­ ì‹œ DBì—ì„œ ìƒì„¸ ë¶ˆëŸ¬ì˜¤ê¸°
        document.addEventListener('click', async (e) => {
            const a = e.target.closest('.order-link');
            if (!a) return;
            e.preventDefault();

            console.log('ğŸŸ¢ [í´ë¦­ ê°ì§€] í´ë¦­ëœ ìš”ì†Œ:', e.target);
            console.log('ğŸŸ¢ order-link ìš”ì†Œ:', a.outerHTML);

            const orderCode = a.dataset.orderCode;
            console.log('ğŸ“¦ [orderCode ì¶”ì¶œ] data-order-code =', orderCode);

            try {
                // âœ… ì„œë²„ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                console.log(`ğŸŒ [fetch ìš”ì²­] /mypage/order/detail?orderCode=${orderCode}`);
                const res = await fetch(`${ctxPath}/mypage/order/detail?orderCode=${orderCode}`);
                console.log('ğŸŒ [ì‘ë‹µ ìƒíƒœ] HTTP', res.status);
                if (!res.ok) throw new Error('âŒ ì£¼ë¬¸ìƒì„¸ ìš”ì²­ ì‹¤íŒ¨');

                // âœ… ì‘ë‹µ JSON ë°›ê¸°
                const dataList = await res.json();
                console.log('ğŸ“¥ [ì‘ë‹µ JSON ì „ì²´]', dataList);

                if (!Array.isArray(dataList) || dataList.length === 0) throw new Error('ë¹ˆ ì‘ë‹µ');
                const data = dataList[0];

                // âœ… ì²« ë²ˆì§¸ ìƒí’ˆ ì•„ì´í…œ í™•ì¸
                const firstItem = (data.orderItems && data.orderItems.length > 0) ? data.orderItems[0] : {};
                console.log('ğŸ“¦ [ì²« ìƒí’ˆ ë°ì´í„°]', firstItem);

                // ====== í…Œì´ë¸” ë‚´ë¶€ ë‚´ìš© ì±„ìš°ê¸° ======
                const tbody = modal.querySelector('.order-info tbody');
                console.log('ğŸ§¾ [í…Œì´ë¸” ë°”ì¸ë”© ì‹œì‘]');
                tbody.innerHTML = `
        <tr style="border-bottom: 1px solid #dddddd; height:180px;">
          <td>${data.created_at || '-'}</td>
          <td style="text-align:left; padding-left:10px;">
            <div style="display:flex; align-items:center;">
              <div>
                <img src="${firstItem.url || '/images/noimage.jpg'}" alt="" style="height:121px;">
              </div>
              <div style="padding-left:30px; letter-spacing:-1px;">
                <div style="margin-bottom:5px;">ì£¼ë¬¸ë²ˆí˜¸ : ${data.order_code || '-'}</div>
                <div style="margin-bottom:5px;">${firstItem.company_name || '(ì£¼) ìƒí˜¸ëª…'}</div>
                <div style="margin-bottom:5px;">${firstItem.productName || 'ìƒí’ˆëª…'}</div>
                <div style="margin-bottom:7px;">ìˆ˜ëŸ‰ : ${firstItem.quantity || 1}ê°œ</div>
                <div style="margin-bottom:5px; font-size:20px; font-weight:800;">
                   ${(firstItem.price ?? 0).toLocaleString()}ì›
                </div>
              </div>
            </div>
          </td>
          <td>
            <div style="display:flex; margin-bottom:5px;">
              <div>íŒë§¤ê°€</div>
              <div style="margin-left:auto;">${(firstItem.price ?? 0).toLocaleString()}ì›</div>
            </div>
            <div style="display:flex; margin-bottom:28px;">
              <div>í• ì¸</div>
              <div style="margin-left:auto;">-0ì›</div>
            </div>
            <div style="display:flex;">
              <div>ê²°ì œê¸ˆì•¡</div>
              <div style="margin-left:auto; font-weight:800;">${(data.total_amount ?? 0).toLocaleString()}ì›</div>
            </div>
          </td>
          <td>${data.status || 'ë°°ì†¡ì™„ë£Œ'}</td>
        </tr>
      `;

                console.log('âœ… [í…Œì´ë¸” ì±„ì›€ ì™„ë£Œ]');
                console.log(`ğŸ”¹ ìƒí˜¸ëª…: ${firstItem.company_name}`);
                console.log(`ğŸ”¹ ìƒí’ˆëª…: ${firstItem.product_name}`);
                console.log(`ğŸ”¹ íŒë§¤ê°€: ${firstItem.price_fixed}`);
                console.log(`ğŸ”¹ ê²°ì œê¸ˆì•¡: ${data.total_amount}`);
                console.log(`ğŸ”¹ ìƒíƒœ: ${data.status}`);

                // âœ… ëª¨ë‹¬ ì—´ê¸°
                openOrderModal(data);

            } catch (err) {
                console.error('âŒ [ì˜¤ë¥˜ ë°œìƒ] ì£¼ë¬¸ ìƒì„¸ ë¡œë”© ì‹¤íŒ¨:', err);
                alert('ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
            }
        });

        // âœ… ë‹«ê¸° ë²„íŠ¼, ë°°ê²½ í´ë¦­, ESC ì´ë²¤íŠ¸ ì—°ê²°
        btnClose.addEventListener('click', closeOrderModal);
        backdrop.addEventListener('click', (e) => {
            if (e.target === backdrop) closeOrderModal();
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('is-open')) closeOrderModal();
        });
    </script>


    <!-- ì£¼ë¬¸ ìƒì„¸ ë§ˆì´í˜ì´ì§€_ë©”ì¸#2-->
  <!-- ì£¼ë¬¸ ìƒì„¸ ë§ˆì´í˜ì´ì§€_ë©”ì¸#3-->
   <!-- ===== íŒë§¤ìì •ë³´ ëª¨ë‹¬ ===== -->
<div class="modal-backdrop" id="sellerModalBackdrop" aria-hidden="true"></div>
<div class="modal" id="sellerModal" role="dialog" aria-modal="true" aria-labelledby="sellerModalTitle" aria-hidden="true">
  <div class="modal-dialog" tabindex="-1" style="border-radius:0 !important;">
    <div class="modal-header" style="border-radius:0 !important;">
      <div>
        <span id="sellerModalTitle">íŒë§¤ìì •ë³´</span>
      </div>
      <button class="modal-close" type="button" aria-label="ë‹«ê¸°" id="sellerModalClose">âœ•</button>
    </div>

    <div class="modal-body">
      <div class="section" style="padding:25px;">
        <table class="kv" style="border-top:1px solid #eee;">
            <tr><td>íŒë§¤ì ë“±ê¸‰</td><td id="s-grade">ê³¨ë“œ</td></tr>
            <tr><td>ìƒí˜¸</td><td id="s-name"></td></tr>
            <tr><td>ëŒ€í‘œì</td><td id="s-rep"></td></tr>
            <tr><td>ì „í™”ë²ˆí˜¸</td><td id="s-tel"></td></tr>
            <tr><td>FAX</td><td id="s-fax"></td></tr>
            <tr><td>Email</td><td id="s-email"></td></tr>
            <tr><td>ì‚¬ì—…ìë²ˆí˜¸</td><td id="s-bizno"></td></tr>
            <tr><td>ì˜ì—…ì†Œì¬ì§€</td><td id="s-addr"></td></tr>
        </table>
        <div style="font-size:12px; color:#666; margin-top:10px;">
          â€» ìœ„ ì •ë³´ëŠ” ì „ììƒê±°ë˜ë²• ì œ20ì¡° ì œ2í•­ ë° ì‹œí–‰ë ¹ ì œ25ì¡° ì œ2í•­ì— ì˜ê±°í•˜ì—¬ ì†Œë¹„ìë³´í˜¸ì— ì˜ê±° ê³µê°œí•©ë‹ˆë‹¤.
        </div>
        <div style="display:flex; justify-content:center; margin-top:14px;">
          <button type="button" id="openInquiryBtn" style="width:120px; height:36px; border:0; background:#000000; color:#fff; font-weight:300;">ë¬¸ì˜í•˜ê¸°</button>
        </div>
      </div>
    </div>
    <button class="sr-only" id="sellerSentinel"></button>
  </div>
</div>
<script>
  // ====== íŒë§¤ì ëª¨ë‹¬ ì œì–´ ======
  const sModal     = document.getElementById('sellerModal');
  const sBackdrop  = document.getElementById('sellerModalBackdrop');
  const sBtnClose  = document.getElementById('sellerModalClose');
  const sSentinel  = document.getElementById('sellerSentinel');

  // íŒë§¤ìëª¨ë‹¬ ì¬ì˜¤í”ˆì„ ìœ„í•´ ë§ˆì§€ë§‰ ë°ì´í„°ì™€ í”Œë˜ê·¸ ì €ì¥
  let __lastSellerData = null;
  let __sellerWasOpenBeforeInquiry = false;

  function sSet(id, v){ const el=document.getElementById(id); if(el) el.textContent = v || ''; }

  function openSellerModal(data){
      console.log('ğŸŸ¢ [openSellerModal] í˜¸ì¶œë¨. ì „ë‹¬ëœ ë°ì´í„°:', data);

    __lastSellerData = data; // ë§ˆì§€ë§‰ íŒë§¤ìì •ë³´ ê¸°ì–µ
    sSet('s-name',  data.name);
    sSet('s-rep',   data.rep);
    sSet('s-tel',   data.tel);
    sSet('s-fax',   data.fax);
    sSet('s-email', data.email);
    sSet('s-bizno', data.bizno);
    sSet('s-addr',  data.addr);

    sModal.classList.add('is-open');
    sBackdrop.classList.add('is-open');
    sModal.querySelector('.modal-dialog').focus();
    document.body.style.overflow = 'hidden';

    console.log('âœ… [openSellerModal] ëª¨ë‹¬ ì˜¤í”ˆ ì™„ë£Œ');
  }
  function closeSellerModal(){
      console.log('ğŸ”´ [closeSellerModal] í˜¸ì¶œë¨ â€” ëª¨ë‹¬ ë‹«í˜');
    sModal.classList.remove('is-open');
    sBackdrop.classList.remove('is-open');
    document.body.style.overflow = '';
  }

  // â€œ(ì£¼) ìƒí˜¸ëª…â€ í´ë¦­ â†’ íŒë§¤ì ëª¨ë‹¬ ì˜¤í”ˆ
  document.addEventListener('click', (e) => {
    const a = e.target.closest('.seller-link');
    if(!a) return;

    e.preventDefault();
      console.log('ğŸŸ¡ [í´ë¦­ ê°ì§€] seller-link í´ë¦­ë¨:', a.outerHTML);

      openSellerModal({
      name:  a.dataset.sellerName  || '(ì£¼) ìƒí˜¸ëª…',
      rep:   a.dataset.sellerRep   || 'í™ê¸¸ë™',
      tel:   a.dataset.sellerTel   || '051-123-1000',
      fax:   a.dataset.sellerFax   || '051-123-1001',
      email: a.dataset.sellerEmail || 'company@abc.com',
      bizno: a.dataset.sellerBizno || '123-12-123457',
      addr:  a.dataset.sellerAddr  || '[210**] ë¶€ì‚°ê´‘ì—­ì‹œ ë¶€ì‚°ì§„êµ¬ ëŒ€ì—°ë™ 121 10ì¸µ 1004í˜¸'
    });
  });

  // ë‹«ê¸°(ë²„íŠ¼/ë°°ê²½/Esc) + í¬ì»¤ìŠ¤ íŠ¸ë©
  sBtnClose.addEventListener('click', closeSellerModal);
  sBackdrop.addEventListener('click', closeSellerModal);
  document.addEventListener('keydown', (e)=>{
    if(e.key==='Escape' && sModal.classList.contains('is-open')) closeSellerModal();

    if(e.key==='Tab' && sModal.classList.contains('is-open')){
      const focusables = sModal.querySelectorAll('button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])');
      const first = focusables[0], last = focusables[focusables.length-1];
      if(e.shiftKey && document.activeElement===first){ last.focus(); e.preventDefault(); }
      else if(!e.shiftKey && document.activeElement===last){ first.focus(); e.preventDefault(); }
    }
  });
  sSentinel.addEventListener('focus', ()=> sModal.querySelector('.modal-close').focus());
</script>

  <!-- ì£¼ë¬¸ ìƒì„¸ ë§ˆì´í˜ì´ì§€_ë©”ì¸#3-->
  <!-- ì£¼ë¬¸ ìƒì„¸ ë§ˆì´í˜ì´ì§€_ë©”ì¸#4-->
   <!-- ===== ë¬¸ì˜í•˜ê¸° ëª¨ë‹¬ ===== -->
<div class="modal-backdrop" id="inquiryModalBackdrop" aria-hidden="true"></div>
<div class="modal" id="inquiryModal" role="dialog" aria-modal="true" aria-labelledby="inquiryModalTitle" aria-hidden="true">
  <div class="modal-dialog" tabindex="-1" style="border-radius:0 !important; width:720px; max-width:calc(100% - 40px);">
    <div class="modal-header" style="border-radius:0 !important;">
      <div><span id="inquiryModalTitle">ë¬¸ì˜í•˜ê¸°</span></div>
      <button class="modal-close" type="button" aria-label="ë‹«ê¸°" id="inquiryModalClose">âœ•</button>
    </div>

    <form id="inquiryForm" class="modal-body" style="padding:18px;">
      <!-- ë¬¸ì˜ìœ í˜• -->
      <div class="section" style="padding:0; margin-bottom:12px;">
        <table class="kv" style="border-top:1px solid #eee;">
          <tr>
            <td style="width:100px; text-align:center; background:#f2f2f2;">ë¬¸ì˜ì¢…ë¥˜</td>
            <td>
              <label style="margin-right:14px;"><input type="radio" name="qtype" value="ìƒí’ˆ" checked> ìƒí’ˆ</label>
              <label style="margin-right:14px;"><input type="radio" name="qtype" value="ë°°ì†¡"> ë°°ì†¡</label>
              <label style="margin-right:14px;"><input type="radio" name="qtype" value="ë°˜í’ˆ/ì·¨ì†Œ"> ë°˜í’ˆ/ì·¨ì†Œ</label>
              <label style="margin-right:14px;"><input type="radio" name="qtype" value="êµí™˜"> êµí™˜</label>
              <label><input type="radio" name="qtype" value="ê¸°íƒ€"> ê¸°íƒ€</label>
            </td>
          </tr>
          <tr>
            <td style="text-align:center; background:#f2f2f2;">Email</td>
            <td><input id="inqEmail" name="email" type="email" placeholder="you@example.com"
                       style="border: none; border-bottom: 1px solid gray;width:270px; outline: none; height:34px; padding:6px 8px; box-sizing:border-box;"></td>
          </tr>
          <tr>
            <td style="text-align:center; background:#f2f2f2;">ì œëª©</td>
            <td><input id="inqSubject" name="subject" type="text"
                       style="border: none; border-bottom: 1px solid gray; width:270px; outline: none; height:34px; padding:6px 8px; box-sizing:border-box;"></td>
          </tr>
          <tr>
            <td style="text-align:center; background:#f2f2f2;">ë‚´ìš©</td>
            <td>
              <textarea id="inqBody" name="body" rows="12"
                        style="outline: none; width:100%; resize: none; padding:8px; box-sizing:border-box;"></textarea>
            </td>
          </tr>
        </table>

        <div style="display:flex; justify-content:center; gap:10px; margin-top:16px;">
          <button type="submit"
                  style="min-width:120px; height:38px; border:0; background:#000000; color:#fff; font-weight:300;">
            ë“±ë¡í•˜ê¸°
          </button>
          <button type="button" id="inquiryCancelBtn"
                  style="min-width:120px; height:38px; border:0; background:#ccc; color:#fff;">
            ì·¨ì†Œ
          </button>
        </div>
      </div>
      <button class="sr-only" id="inquirySentinel">ë</button>
    </form>
  </div>
</div>
    <script>
        // ===== ë¬¸ì˜í•˜ê¸° ëª¨ë‹¬ ì œì–´ =====
        const iModal     = document.getElementById('inquiryModal');
        const iBackdrop  = document.getElementById('inquiryModalBackdrop');
        const iBtnClose  = document.getElementById('inquiryModalClose');
        const iCancel    = document.getElementById('inquiryCancelBtn');
        const iForm      = document.getElementById('inquiryForm');
        const iSentinel  = document.getElementById('inquirySentinel');

        function openInquiryModal(prefill){
            const emailInput = document.getElementById('inqEmail');
            emailInput.value = (prefill && prefill.email) || document.getElementById('s-email')?.textContent?.trim() || '';

            iModal.classList.add('is-open');
            iBackdrop.classList.add('is-open');
            iModal.querySelector('.modal-dialog').focus();
            document.body.style.overflow = 'hidden';
        }

        function closeInquiryModal(){
            iModal.classList.remove('is-open');
            iBackdrop.classList.remove('is-open');
            document.body.style.overflow = '';
        }

        document.getElementById('openInquiryBtn')?.addEventListener('click', () => {
            __sellerWasOpenBeforeInquiry = true;
            closeSellerModal && closeSellerModal();
            openInquiryModal({});
        });

        iBtnClose.addEventListener('click', closeInquiryModal);
        iCancel.addEventListener('click', () => {
            closeInquiryModal();
            if (__sellerWasOpenBeforeInquiry && __lastSellerData) {
                openSellerModal(__lastSellerData);
            }
            __sellerWasOpenBeforeInquiry = false;
        });
        iBackdrop.addEventListener('click', closeInquiryModal);

        document.addEventListener('keydown', (e)=>{
            if(e.key==='Escape' && iModal.classList.contains('is-open')) closeInquiryModal();
            if(e.key==='Tab' && iModal.classList.contains('is-open')){
                const focusables = iModal.querySelectorAll('button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])');
                const first = focusables[0], last = focusables[focusables.length-1];
                if(e.shiftKey && document.activeElement===first){ last.focus(); e.preventDefault(); }
                else if(!e.shiftKey && document.activeElement===last){ first.focus(); e.preventDefault(); }
            }
        });
        iSentinel.addEventListener('focus', ()=> iModal.querySelector('.modal-close').focus());

        // âœ… ì‹¤ì œ fetchë¡œ ì„œë²„ì— ì „ì†¡
        iForm.addEventListener('submit', async (e)=>{
            e.preventDefault();
            const data = {
                qtype:   iForm.qtype.value,
                email:   iForm.email.value.trim(),
                subject: iForm.subject.value.trim(),
                content: iForm.body.value.trim()
            };

            try {
                console.log(`ğŸ“¡ POST â†’ ${ctxPath}/api/mypage/inquiry`);
                const res = await fetch(`${ctxPath}/api/mypage/inquiry`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });

                if (res.ok) {
                    alert('ë¬¸ì˜ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeInquiryModal();
                } else {
                    const msg = await res.text();
                    alert('âŒ ì˜¤ë¥˜: ' + msg);
                }
            } catch (err) {
                console.error('ğŸš¨ ì„œë²„ ì˜¤ë¥˜:', err);
                alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });
    </script>


    <!-- ì£¼ë¬¸ ìƒì„¸ ë§ˆì´í˜ì´ì§€_ë©”ì¸#4-->
  <!-- ì£¼ë¬¸ ìƒì„¸ ë§ˆì´í˜ì´ì§€_ë©”ì¸#5-->
  <!-- ===== êµ¬ë§¤í™•ì • ëª¨ë‹¬ ===== -->
  <div class="modal-backdrop" id="buyModalBackdrop" aria-hidden="true"></div>
  <div class="modal" id="buyModal" role="dialog" aria-modal="true" aria-labelledby="buyModalTitle" aria-hidden="true">
    <div class="modal-dialog" tabindex="-1" style="border-radius:0 !important; width:420px; max-width:calc(100% - 40px);">
      <div class="modal-header" style="border-radius:0 !important;">
        <div><span id="buyModalTitle">êµ¬ë§¤í™•ì •</span></div>
        <button class="modal-close" type="button" aria-label="ë‹«ê¸°" id="buyClose">âœ•</button>
      </div>

      <div class="modal-body" style="padding:57px 37px 30px">
        <p style="margin:0 0 3px 0; font-size:16px; line-height:1.6;">ìƒí’ˆì„ ë°›ìœ¼ì…¨ë‚˜ìš”?</p>
        <p style="margin:0 0 55px 0; color:#555; line-height:1.6;">ìƒí’ˆì„ ë°›ìœ¼ì‹  ë¶„ë§Œ êµ¬ë§¤í™•ì •ì„ í•´ì£¼ì„¸ìš”.</p>

        <div style="display:flex; justify-content:center; gap:10px; margin-top:18px;">
          <button type="button" id="buyOk"
                  style="min-width:120px; height:38px; border:0; background:#000000; color:#fff; font-weight:300;">
            í™•ì¸
          </button>
          <button type="button" id="buyCancel"
                  style="min-width:120px; height:38px; border:0; background:#ccc; color:#fff;">
            ì·¨ì†Œ
          </button>
        </div>
        <button class="sr-only" id="buySentinel"></button>
      </div>
    </div>
  </div>
  <script>
    // ===== êµ¬ë§¤í™•ì • ëª¨ë‹¬ ì œì–´ =====
    const buyModal     = document.getElementById('buyModal');
    const buyBackdrop  = document.getElementById('buyModalBackdrop');
    const buyCloseBtn  = document.getElementById('buyClose');
    const buyOk        = document.getElementById('buyOk');
    const buyCancel    = document.getElementById('buyCancel');
    const buySentinel  = document.getElementById('buySentinel');

    let __currentOrderId = null;   // ì–´ë–¤ ì£¼ë¬¸ì„ í™•ì •í•˜ëŠ”ì§€ ë³´ê´€

    function openBuyModal(orderId){
      __currentOrderId = orderId || null;
      buyModal.classList.add('is-open');
      buyBackdrop.classList.add('is-open');
      buyModal.querySelector('.modal-dialog').focus();
      document.body.style.overflow = 'hidden';
    }
    function closeBuyModal(){
      buyModal.classList.remove('is-open');
      buyBackdrop.classList.remove('is-open');
      document.body.style.overflow = '';
    }

    // â€œêµ¬ë§¤í™•ì •â€ ë²„íŠ¼ í´ë¦­ â†’ ëª¨ë‹¬ ì˜¤í”ˆ (ì´ë²¤íŠ¸ ìœ„ì„)
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('.confirm-purchase');
      if(!btn) return;

      // ê°™ì€ í–‰ì˜ ì£¼ë¬¸ë²ˆí˜¸(ì£¼ë¬¸ë²ˆí˜¸ : xxxx)ì—ì„œ idë¥¼ ì°¾ì•„ë´„
      const row = btn.closest('tr');
      const orderLink = row?.querySelector('.order-link');
      const orderId = orderLink?.dataset.orderId || null;

      e.preventDefault();
      openBuyModal(orderId);
    });

    // í™•ì¸/ì·¨ì†Œ/ë‹«ê¸°/ë°±ë“œë¡­/Esc
    buyOk.addEventListener('click', ()=>{
      // TODO: ì‹¤ì œ êµ¬ë§¤í™•ì • API í˜¸ì¶œ(fetch) ìœ„ì¹˜
      console.log('êµ¬ë§¤í™•ì • ì²˜ë¦¬ - ì£¼ë¬¸ë²ˆí˜¸:', __currentOrderId);

      // ë°ëª¨ë¡œ ë²„íŠ¼ ìƒíƒœë§Œ ë³€ê²½
      if (__currentOrderId){
        const btn = document.querySelector(`.order-link[data-order-id="${__currentOrderId}"]`)
                    ?.closest('tr')?.querySelector('.confirm-purchase');
        if (btn){
          btn.style.border = 'none';
          btn.textContent = 'êµ¬ë§¤í™•ì •ì™„ë£Œ';
          btn.disabled = true;
          btn.style.background = '#ccc';
          btn.style.color = '#fff';
          btn.style.cursor = 'default';
        }
      }
      closeBuyModal();
    });
    buyCancel.addEventListener('click', closeBuyModal);
    buyCloseBtn.addEventListener('click', closeBuyModal);
    buyBackdrop.addEventListener('click', closeBuyModal);
    document.addEventListener('keydown', (e)=>{
      if (e.key === 'Escape' && buyModal.classList.contains('is-open')) closeBuyModal();

      // í¬ì»¤ìŠ¤ íŠ¸ë©
      if (e.key === 'Tab' && buyModal.classList.contains('is-open')){
        const focusables = buyModal.querySelectorAll('button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])');
        const first = focusables[0], last = focusables[focusables.length-1];
        if (e.shiftKey && document.activeElement===first) { last.focus(); e.preventDefault(); }
        else if (!e.shiftKey && document.activeElement===last) { first.focus(); e.preventDefault(); }
      }
    });
    buySentinel.addEventListener('focus', ()=> buyModal.querySelector('.modal-close').focus());
  </script>
  <!-- ì£¼ë¬¸ ìƒì„¸ ë§ˆì´í˜ì´ì§€_ë©”ì¸#5-->
  <!-- ì£¼ë¬¸ ìƒì„¸ ë§ˆì´í˜ì´ì§€_ë©”ì¸#6-->
  <!-- ===== ìƒí’ˆí‰ ëª¨ë‹¬ ===== -->
    <div class="modal-backdrop" id="reviewModalBackdrop" aria-hidden="true"></div>

    <div class="modal" id="reviewModal" role="dialog" aria-modal="true"
         aria-labelledby="reviewModalTitle" aria-hidden="true">

        <div class="modal-dialog" tabindex="-1"
             style="border-radius:0 !important; width:720px; max-width:calc(100% - 40px);">

            <div class="modal-header" style="border-radius:0 !important;">
                <div><span id="reviewModalTitle">ìƒí’ˆí‰ì‘ì„±í•˜ê¸°</span></div>
                <button class="modal-close" type="button" aria-label="ë‹«ê¸°" id="reviewClose">âœ•</button>
            </div>

            <form id="reviewForm" class="modal-body review-form">
                <table class="review-grid" style="border-top:1px solid #eee;">
                    <tr>
                        <td>ìƒí’ˆëª…</td>
                        <td><span id="rvProductName">ìƒí’ˆëª… ì¶œë ¥</span></td>
                    </tr>

                    <tr>
                        <td>ë§Œì¡±ë„</td>
                        <td>
                            <div class="rating" role="radiogroup" aria-label="ë§Œì¡±ë„">
                                <input type="radio" id="star5" name="rating" value="5"><label for="star5" title="5ì "></label>
                                <input type="radio" id="star4" name="rating" value="4"><label for="star4" title="4ì "></label>
                                <input type="radio" id="star3" name="rating" value="3"><label for="star3" title="3ì "></label>
                                <input type="radio" id="star2" name="rating" value="2"><label for="star2" title="2ì "></label>
                                <input type="radio" id="star1" name="rating" value="1"><label for="star1" title="1ì "></label>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <td>ë‚´ìš©</td>
                        <td>
            <textarea id="rvBody" name="body" class="review-textarea"
                      placeholder="ìµœì†Œ 10ì ì´ìƒ, 200ì ë‚´ì™¸ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”."></textarea>
                            <div class="char-count"><span id="rvCount">0</span>/200</div>
                        </td>
                    </tr>

                    <tr>
                        <td>ì‚¬ì§„</td>
                        <td>
                            <input type="file" name="photo1" accept="image/*" style="display:block; margin-bottom:8px;">
                            <input type="file" name="photo2" accept="image/*" style="display:block; margin-bottom:8px;">
                            <input type="file" name="photo3" accept="image/*" style="display:block;">
                        </td>
                    </tr>
                </table>

                <div class="review-actions" style="margin-top:20px; text-align:center;">
                    <button type="submit"
                            style="min-width:120px; height:38px; border:0; background:#000000; color:#fff; font-weight:300;">
                        ì‘ì„±ì™„ë£Œ
                    </button>
                    <button type="button" id="reviewCancel"
                            style="min-width:120px; height:38px; border:0; background:#ccc; color:#fff;">
                        ì·¨ì†Œ
                    </button>
                </div>

                <button class="sr-only" id="reviewSentinel">ë</button>
            </form>
        </div>
    </div>
    <script>
        // ===== ìƒí’ˆí‰ ëª¨ë‹¬ ì œì–´ =====
        const rModal    = document.getElementById('reviewModal');
        const rBackdrop = document.getElementById('reviewModalBackdrop');
        const rCloseBtn = document.getElementById('reviewClose');
        const rCancel   = document.getElementById('reviewCancel');
        const rForm     = document.getElementById('reviewForm');
        const rSentinel = document.getElementById('reviewSentinel');

        // âœ… rvTitle ëŒ€ì‹  ìƒí’ˆëª… ì¶œë ¥ìš© span
        const rvProductName = document.getElementById('rvProductName');

        const rvBody  = document.getElementById('rvBody');
        const rvCount = document.getElementById('rvCount');

        // âœ… ì „ì—­ ë³€ìˆ˜ë¡œ í˜„ì¬ ìƒí’ˆ ID ì €ì¥
        let currentProductId = null;

        // í–‰ì˜ ìƒí’ˆëª… í…ìŠ¤íŠ¸ë¥¼ ì°¾ê¸°
        function getRowProductName(btn){
            const row = btn.closest('tr');
            const nameEl = row?.querySelector('td:nth-child(2) a[href="#"]:not(.order-link):not(.seller-link)');
            return nameEl?.textContent?.trim() || 'ìƒí’ˆëª…';
        }

        function openReviewModal(prefill){
            // âœ… ìƒí’ˆëª… ì„¸íŒ…
            if (rvProductName) rvProductName.textContent = prefill?.productName || 'ìƒí’ˆëª…';

            // ë³¸ë¬¸/ë³„ì  í”„ë¦¬ì…‹
            rvBody.value  = prefill?.body || '';

            // ê¸€ììˆ˜ ì´ˆê¸°í™”
            rvCount.textContent = String(rvBody.value.length);

            // ëª¨ë‹¬ ì˜¤í”ˆ
            rModal.classList.add('is-open');
            rBackdrop.classList.add('is-open');
            rModal.querySelector('.modal-dialog').focus();
            document.body.style.overflow = 'hidden';
        }

        function closeReviewModal(){
            rModal.classList.remove('is-open');
            rBackdrop.classList.remove('is-open');
            document.body.style.overflow = '';
        }

        // ë³¸ë¬¸ 200ì ì œí•œ
        rvBody.addEventListener('input', () => {
            if (rvBody.value.length > 200) rvBody.value = rvBody.value.slice(0,200);
            rvCount.textContent = String(rvBody.value.length);
        });

        // â€œìƒí’ˆí‰ì“°ê¸°â€ ë²„íŠ¼ â†’ ì˜¤í”ˆ
        document.addEventListener('click', (e) => {
            const btn = e.target.closest('.review-btn');
            if (!btn) return;
            e.preventDefault();

            // ë²„íŠ¼ì— ì €ì¥ëœ ìƒí’ˆ ID/ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
            currentProductId = btn.dataset.productId;
            const productName = btn.dataset.productName;

            // âœ…
            console.log("ğŸ§© ë²„íŠ¼ dataset.productId:", currentProductId);
            console.log("ğŸ§© ë²„íŠ¼ dataset.productName:", productName);

            // ëª¨ë‹¬ ì˜¤í”ˆ ì‹œ ìƒí’ˆëª… í‘œì‹œ
            openReviewModal({ productName });
        });

        // ë‹«ê¸°/ì·¨ì†Œ/ë°±ë“œë¡­/Esc
        rCloseBtn.addEventListener('click', closeReviewModal);
        rCancel.addEventListener('click', closeReviewModal);
        rBackdrop.addEventListener('click', closeReviewModal);
        document.addEventListener('keydown', (e)=>{
            if(e.key==='Escape' && rModal.classList.contains('is-open')) closeReviewModal();

            // í¬ì»¤ìŠ¤ íŠ¸ë©
            if(e.key==='Tab' && rModal.classList.contains('is-open')){
                const focusables = rModal.querySelectorAll('button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])');
                const first = focusables[0], last = focusables[focusables.length-1];
                if(e.shiftKey && document.activeElement===first){ last.focus(); e.preventDefault(); }
                else if(!e.shiftKey && document.activeElement===last){ first.focus(); e.preventDefault(); }
            }
        });
        rSentinel.addEventListener('focus', ()=> rModal.querySelector('.modal-close').focus());

        // ì œì¶œ
        rForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const selected = rForm.querySelector('input[name="rating"]:checked');
            const rating = selected ? Number(selected.value) : 0;

            if (rating === 0) {
                alert('ë§Œì¡±ë„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            if (rForm.body.value.trim().length < 10) {
                alert('ë‚´ìš©ì€ ìµœì†Œ 10ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // âœ… ì„œë²„ì— ë³´ë‚¼ ë°ì´í„° êµ¬ì„±
            const formData = new FormData();
            formData.append("productId", currentProductId);
            formData.append("rating", rating);
            formData.append("body", rForm.body.value.trim());

            // âœ… ì „ì†¡ ì „ productId í™•ì¸ ë¡œê·¸
            console.log("ğŸ§© ì „ì†¡ë˜ëŠ” productId:", currentProductId);
            console.log("â­ rating:", rating);
            console.log("ğŸ“ body:", rForm.body.value.trim());

            try {
                const res = await fetch(`${ctxPath}/api/mypage/review`, {
                    method: 'POST',
                    body: formData
                });

                if (!res.ok) throw new Error('ë¦¬ë·° ë“±ë¡ ì‹¤íŒ¨');

                alert('ìƒí’ˆí‰ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                closeReviewModal();

            } catch (err) {
                console.error('âŒ ìƒí’ˆí‰ ì „ì†¡ ì˜¤ë¥˜:', err);
                alert('ìƒí’ˆí‰ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });



    </script>
  <!-- ì£¼ë¬¸ ìƒì„¸ ë§ˆì´í˜ì´ì§€_ë©”ì¸#6-->
  <!-- ì£¼ë¬¸ ìƒì„¸ ë§ˆì´í˜ì´ì§€_ë©”ì¸#7-->
   <!-- ===== ë°˜í’ˆì‹ ì²­ ëª¨ë‹¬ ===== -->
<div class="modal-backdrop" id="returnModalBackdrop" aria-hidden="true"></div>
<div class="modal" id="returnModal" role="dialog" aria-modal="true" aria-labelledby="returnModalTitle" aria-hidden="true">
  <div class="modal-dialog" tabindex="-1" style="border-radius:0 !important; width:860px; max-width:calc(100% - 40px);">
    <div class="modal-header" style="border-radius:0 !important;">
      <div>
        <span id="returnModalTitle">ë°˜í’ˆì‹ ì²­</span>
      </div>
      <button class="modal-close" type="button" aria-label="ë‹«ê¸°" id="returnClose">âœ•</button>
    </div>

    <div class="modal-body">
      <!-- ìƒí’ˆì •ë³´(ìš”ì•½) -->
      <div class="section" style="padding-top:16px;">
        <div class="section-title">ìƒí’ˆì •ë³´</div>
        <table class="order-info" style="border-top:1px solid; text-align:center; vertical-align:middle;">
          <thead>
            <tr style="background:#dedede !important;">
              <th style="width:120px;">ë‚ ì§œ</th>
              <th style="width:400px;">ìƒí’ˆì •ë³´</th>
              <th style="width:165px;">ê²°ì œê¸ˆì•¡</th>
              <th>ìƒíƒœ</th>
            </tr>
          </thead>
          <tbody>
            <tr style="border-bottom:1px solid #ddd; height:160px;">
              <td id="rtDate">0000-00-00</td>
              <td style="text-align:left; padding-left:10px;">
                <div style="display:flex; align-items:center;">
                  <div><img id="rtThumb" th:src="@{/images/product_list1.jpg}" alt="" style="height:100px;"></div>
                  <div style="padding-left:20px; letter-spacing:-1px;">
                    <div style="margin-bottom:4px; color:gray;">ì£¼ë¬¸ë²ˆí˜¸ : <span id="rtOrderNo">-</span></div>
                    <div style="margin-bottom:4px; color:gray;" id="rtSeller">(ì£¼) ìƒí˜¸ëª…</div>
                    <div style="margin-bottom:6px; color:gray;" id="rtName">ìƒí’ˆëª…</div>
                    <div style="margin-bottom:6px;" id="rtQty">ìˆ˜ëŸ‰ : 1ê°œ</div>
                    <div style="font-size:18px; font-weight:800;" id="rtPrice">34,000ì›</div>
                  </div>
                </div>
              </td>
              <td id="rtPay">
                <div style=" display: flex; margin-bottom: 5px;">
                    <div>íŒë§¤ê°€</div>
                    <div style="margin-left: auto;">34,000ì›</div>
                </div>
                <div style=" display: flex; margin-bottom: 28px;">
                    <div>í• ì¸</div>
                    <div style="margin-left: auto;">-3,000ì›</div>
                </div>
                <div style=" display: flex;">
                    <div>ê²°ì œê¸ˆì•¡</div>
                    <div style="margin-left: auto; font-weight: 800;">31,000ì›</div>
                </div>
              </td>
              <td id="rtStatus">ë°°ì†¡ì™„ë£Œ</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- ë°˜í’ˆì •ë³´ ì…ë ¥ -->
      <div class="section" style="padding-top:2px;">
        <div class="section-title">ë°˜í’ˆì •ë³´ ì…ë ¥</div>
        <table class="kv" style="border-top:1px solid #eee;">
          <tr>
            <td>ë°˜í’ˆìœ í˜•</td>
            <td>
              <label style="margin-right:14px;"><input type="radio" name="rtType" value="ë‹¨ìˆœ ë³€ì‹¬"> ë‹¨ìˆœ ë³€ì‹¬</label>
              <label style="margin-right:14px;"><input type="radio" name="rtType" value="íŒŒì† ë° ë¶ˆëŸ‰"> íŒŒì† ë° ë¶ˆëŸ‰</label>
              <label style="margin-right:14px;"><input type="radio" name="rtType" value="ì£¼ë¬¸ ì‹¤ìˆ˜"> ì£¼ë¬¸ ì‹¤ìˆ˜</label>
              <label><input type="radio" name="rtType" value="ê¸°íƒ€"> ê¸°íƒ€</label>
            </td>
          </tr>
          <tr>
            <td>ì‚¬ìœ ì…ë ¥</td>
            <td>
              <textarea id="rtReason" rows="7" style="width:100%; resize:none; outline:none; padding:8px; box-sizing:border-box;"
                        placeholder="ë°˜í’ˆ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”. (ìµœì†Œ 10ì)"></textarea>
            </td>
          </tr>
          <tr>
            <td>ì‚¬ì§„ì²¨ë¶€(ì„ íƒ)</td>
            <td >
              <input type="file" id="rtFile1" class="visually-hidden">
              <label for="rtFile1" class="btn-file">íŒŒì¼ ì„ íƒ</label>
              <span id="rtFile1Name">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
            </td>
          </tr>
          <style>
            /* í™”ë©´ì—ì„œë§Œ ìˆ¨ê¹€(ì ‘ê·¼ì„± OK) */
            .visually-hidden{
              position:absolute; width:1px; height:1px; padding:0; margin:-1px;
              overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
            }

            /* ìš°ë¦¬ ì‚¬ì´íŠ¸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
            .btn-file{
              display:inline-block;
              min-width:96px;
              padding:8px 14px;
              background:#dedede;
              color:#fff;
              border:0;
              font-weight:300;
              text-align:center;
              cursor:pointer;
            }

            .btn-file:hover{ filter:brightness(0.95); }
            .btn-file:focus-visible{ outline:2px solid #000000; outline-offset:2px; }

            #rtFile1Name{ margin-left:8px; color:#666; }

          </style>
          <script>
            // íŒŒì¼ëª… í‘œì‹œ
            document.getElementById('rtFile1').addEventListener('change', function(){
              const nameSpan = document.getElementById('rtFile1Name');
              nameSpan.textContent = this.files?.length ? this.files[0].name : 'ì„ íƒëœ íŒŒì¼ ì—†ìŒ';
            });
          </script>
        </table>

        <div style="display:flex; justify-content:center; gap:10px; margin-top:16px;">
          <button type="button" id="rtSubmit"
                  style="min-width:120px; height:38px; border:0; background:#000000; color:#fff; font-weight:300;">ë°˜í’ˆì‹ ì²­</button>
          <button type="button" id="rtCancel"
                  style="min-width:120px; height:38px; border:0; background:#ccc; color:#fff;">ì·¨ì†Œ</button>
        </div>
      </div>
    </div>

    <button class="sr-only" id="returnSentinel"></button>
  </div>
</div>
    <script>
        // ===== ë°˜í’ˆì‹ ì²­ ëª¨ë‹¬ ì œì–´ =====
        const rtModal     = document.getElementById('returnModal');
        const rtBackdrop  = document.getElementById('returnModalBackdrop');
        const rtClose     = document.getElementById('returnClose');
        const rtCancel    = document.getElementById('rtCancel');
        const rtSubmit    = document.getElementById('rtSubmit');
        const rtSentinel  = document.getElementById('returnSentinel');
        const userId = document.getElementById('userData')?.dataset.userId || null;

        function setText(id, v){ const el=document.getElementById(id); if(el) el.textContent = v; }
        function setSrc(id, v){ const el=document.getElementById(id); if(el) el.src = v; }
        // === ê³µí†µ ì´ë¯¸ì§€ ê²½ë¡œ ì²˜ë¦¬ ===
        function resolveImageUrl(imgPath) {
            if (!imgPath) return `${ctxPath}/images/no_image.jpg`;
            if (imgPath.startsWith('http')) return imgPath;
            return `${ctxPath}/${imgPath.replace(/^\/+/, '')}`;
        }


        // âœ… DBì—ì„œ ë°˜í’ˆ ìƒí’ˆ ìƒì„¸ ë¶ˆëŸ¬ì˜¤ê¸°
        async function openReturnModal(fromBtn){
            const productBlock = fromBtn.closest('div');
            const orderItemId = fromBtn.dataset.orderItemId;
            const userId = document.getElementById('userData')?.dataset.userId || null;
            // âœ… ë²„íŠ¼ì—ì„œ ì§ì ‘ img ì¶”ì 
            const thumb = productBlock?.querySelector('img')?.getAttribute('src') ||
                fromBtn.dataset.productImg ||
                '/NICHIYA/images/no_image.jpg';


            setSrc('rtThumb', thumb);


            console.log("ğŸ“¦ [DEBUG] ë°˜í’ˆ ë²„íŠ¼ í´ë¦­ë¨:", orderItemId, "í˜„ì¬ userId:", userId);

            try {
                const res = await fetch(`${ctxPath}/api/mypage/exchange/item/${orderItemId}`);
                if (!res.ok) throw new Error('ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                const data = await res.json();

                console.log("ğŸ“¦ [DEBUG] DBì¡°íšŒ ê²°ê³¼:", data);

                // âœ… ëª¨ë‹¬ ë°ì´í„° ì„¸íŒ…
                setText('rtDate', data.ORDER_DATE);
                setText('rtOrderNo', data.ORDER_CODE);
                setText('rtSeller', `(ì£¼) ${data.COMPANY_NAME}`);
                setText('rtName', data.PRODUCT_NAME);
                setText('rtQty', `ìˆ˜ëŸ‰ : ${data.QUANTITY}ê°œ`);
                setText('rtPrice', `${Number(data.ORIGINAL_PRICE).toLocaleString()}ì›`);
                setText('rtStatus', data.ORDER_STATUS);
                setSrc('rtThumb', resolveImageUrl(data.url) || '/NICHIYA/images/no_image.jpg'); // âœ… ìˆ˜ì •ë¨

                // âœ… ê°€ê²©í‘œì‹œ
                const rtPayEl = document.getElementById('rtPay');
                const discount = Number(data.DISCOUNT_PRICE) < 0 ? data.DISCOUNT_PRICE : `-${data.DISCOUNT_PRICE}`;
                const total = Number(data.PAID_PRICE).toLocaleString();

                rtPayEl.innerHTML = `
                <div style="display:flex; margin-bottom:5px;">
                    <div>íŒë§¤ê°€</div><div style="margin-left:auto;">${Number(data.ORIGINAL_PRICE).toLocaleString()}ì›</div>
                </div>
                <div style="display:flex; margin-bottom:28px;">
                    <div>í• ì¸</div><div style="margin-left:auto;">${discount}ì›</div>
                </div>
                <div style="display:flex;">
                    <div>ê²°ì œê¸ˆì•¡</div><div style="margin-left:auto; font-weight:800;">${total}ì›</div>
                </div>
            `;

                // ì…ë ¥ ì´ˆê¸°í™”
                document.querySelectorAll('input[name="rtType"]').forEach(r=> r.checked=false);
                document.getElementById('rtReason').value = '';
                document.getElementById('rtFile1').value = '';
                document.getElementById('rtFile1Name').textContent = 'ì„ íƒëœ íŒŒì¼ ì—†ìŒ';

                // âœ… ëª¨ë‹¬ ì˜¤í”ˆ
                rtModal.classList.add('is-open');
                rtBackdrop.classList.add('is-open');
                rtModal.querySelector('.modal-dialog').focus();
                document.body.style.overflow = 'hidden';

                const rtNameEl = document.getElementById('rtName');
                if (rtNameEl) rtNameEl.dataset.orderItemId = orderItemId;

            } catch (err) {
                console.error("âŒ [DEBUG] ë°˜í’ˆ ëª¨ë‹¬ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
                alert("ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
        }

        function closeReturnModal(){
            rtModal.classList.remove('is-open');
            rtBackdrop.classList.remove('is-open');
            document.body.style.overflow = '';
        }

        document.getElementById('rtFile1').addEventListener('change', function(){
            const nameSpan = document.getElementById('rtFile1Name');
            nameSpan.textContent = this.files?.length ? this.files[0].name : 'ì„ íƒëœ íŒŒì¼ ì—†ìŒ';
        });

        document.addEventListener('click', (e)=>{
            const btn = e.target.closest('.return-btn');
            if(!btn) return;
            e.preventDefault();
            openReturnModal(btn);
        });

        rtClose.addEventListener('click', closeReturnModal);
        rtCancel.addEventListener('click', closeReturnModal);
        rtBackdrop.addEventListener('click', closeReturnModal);

        // ===== ë°˜í’ˆì‹ ì²­ ì „ì†¡ =====
        rtSubmit.addEventListener('click', async ()=>{
            const type = document.querySelector('input[name="rtType"]:checked')?.value || '';
            const reason = document.getElementById('rtReason').value.trim();
            const userId = document.getElementById('userData')?.dataset.userId || null;
            const orderItemId = document.getElementById('rtName')?.dataset.orderItemId;
            const fileInput = document.getElementById('rtFile1');

            if (!type) return alert('ë°˜í’ˆìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            if (reason.length < 10) return alert('ì‚¬ìœ ë¥¼ ìµœì†Œ 10ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            if (!userId) return alert('ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
            if (!orderItemId) return alert('ìƒí’ˆ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

            const formData = new FormData();
            formData.append("order_item_id", orderItemId);
            formData.append("user_id", userId);
            formData.append("reason_text", reason);
            formData.append("reason_code", type);
            formData.append("status", "REQUESTED");
            formData.append("pickupAddress", "");

            if (fileInput.files.length > 0) {
                formData.append("evidence_urls", fileInput.files[0]);
            }

            try {
                const res = await fetch(`${ctxPath}/api/mypage/return`, {
                    method: 'POST',
                    body: formData
                });
                if (!res.ok) throw new Error('ì„œë²„ ì˜¤ë¥˜');
                alert('ë°˜í’ˆì‹ ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
                closeReturnModal();
            } catch (err) {
                console.error('âŒ ë°˜í’ˆì‹ ì²­ ì‹¤íŒ¨:', err);
                alert('ë°˜í’ˆì‹ ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });
    </script>

  <!-- ì£¼ë¬¸ ìƒì„¸ ë§ˆì´í˜ì´ì§€_ë©”ì¸#7-->
  <!-- ì£¼ë¬¸ ìƒì„¸ ë§ˆì´í˜ì´ì§€_ë©”ì¸#8-->
  <!-- ===== êµí™˜ì‹ ì²­ ëª¨ë‹¬ ===== -->
<div class="modal-backdrop" id="exchangeModalBackdrop" aria-hidden="true"></div>
<div class="modal" id="exchangeModal" role="dialog" aria-modal="true" aria-labelledby="exchangeModalTitle" aria-hidden="true">
  <div class="modal-dialog" tabindex="-1" style="border-radius:0 !important; width:860px; max-width:calc(100% - 40px);">
    <div class="modal-header" style="border-radius:0 !important;">
      <div><span id="exchangeModalTitle">êµí™˜ì‹ ì²­</span></div>
      <button class="modal-close" type="button" aria-label="ë‹«ê¸°" id="exClose">âœ•</button>
    </div>

    <div class="modal-body">
      <!-- ìƒí’ˆì •ë³´(ìš”ì•½) -->
      <div class="section" style="padding-top:16px;">
        <div class="section-title">ìƒí’ˆì •ë³´</div>
        <table class="order-info" style="border-top:1px solid; text-align:center; vertical-align:middle;">
          <thead>
            <tr style="background:#dedede !important;">
              <th style="width:120px;">ë‚ ì§œ</th>
              <th style="width:400px;">ìƒí’ˆì •ë³´</th>
              <th style="width:165px;">ê²°ì œê¸ˆì•¡</th>
              <th>ìƒíƒœ</th>
            </tr>
          </thead>
          <tbody>
            <tr style="border-bottom:1px solid #ddd; height:160px;">
              <td id="exDate">0000-00-00</td>
              <td style="text-align:left; padding-left:10px;">
                <div style="display:flex; align-items:center;">
                  <div><img id="exThumb" th:src="@{/images/product_list1.jpg}" alt="" style="height:100px;"></div>
                  <div style="padding-left:20px; letter-spacing:-1px;">
                    <div style="margin-bottom:4px; color:gray;">ì£¼ë¬¸ë²ˆí˜¸ : <span id="exOrderNo">-</span></div>
                    <div style="margin-bottom:4px; color:gray;" id="exSeller">(ì£¼) ìƒí˜¸ëª…</div>
                    <div style="margin-bottom:6px; color:gray;" id="exName">ìƒí’ˆëª…</div>
                    <div style="margin-bottom:6px;" id="exQty">ìˆ˜ëŸ‰ : 1ê°œ</div>
                    <div style="font-size:18px; font-weight:800;" id="exPrice">34,000ì›</div>
                  </div>
                </div>
              </td>
              <td id="exPay">
                <div style="display:flex; margin-bottom:5px;">
                  <div>íŒë§¤ê°€</div>
                  <div style="margin-left:auto;">34,000ì›</div>
                </div>
                <div style="display:flex; margin-bottom:28px;">
                  <div>í• ì¸</div>
                  <div style="margin-left:auto;">-3,000ì›</div>
                </div>
                <div style="display:flex;">
                  <div>ê²°ì œê¸ˆì•¡</div>
                  <div style="margin-left:auto; font-weight:800;">31,000ì›</div>
                </div>
              </td>
              <td id="exStatus">ë°°ì†¡ì™„ë£Œ</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- êµí™˜ì •ë³´ ì…ë ¥ -->
      <div class="section" style="padding-top:2px;">
        <div class="section-title">êµí™˜ì •ë³´ ì…ë ¥</div>
        <table class="kv" style="border-top:1px solid #eee;">
          <tr>
            <td>êµí™˜ìœ í˜•</td>
            <td>
              <label style="margin-right:14px;"><input type="radio" name="exType" value="ë‹¨ìˆœ êµí™˜"> ë‹¨ìˆœ êµí™˜</label>
              <label style="margin-right:14px;"><input type="radio" name="exType" value="íŒŒì† ë° ë¶ˆëŸ‰"> íŒŒì† ë° ë¶ˆëŸ‰</label>
              <label style="margin-right:14px;"><input type="radio" name="exType" value="ì£¼ë¬¸ ì‹¤ìˆ˜"> ì£¼ë¬¸ ì‹¤ìˆ˜</label>
              <label><input type="radio" name="exType" value="ê¸°íƒ€"> ê¸°íƒ€</label>
            </td>
          </tr>
          <tr>
            <td>ì‚¬ìœ ì…ë ¥</td>
            <td>
              <textarea id="exReason" rows="7" style="width:100%; resize:none; outline:none; padding:8px; box-sizing:border-box;"
                        placeholder="êµí™˜ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”. (ìµœì†Œ 10ì)"></textarea>
            </td>
          </tr>
          <tr>
            <td>ì‚¬ì§„ì²¨ë¶€(ì„ íƒ)</td>
            <td style="vertical-align:middle;">
              <input type="file" id="exFile1" class="visually-hidden" accept="image/*">
              <label for="exFile1" class="btn-file">íŒŒì¼ ì„ íƒ</label>
              <span id="exFile1Name">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
            </td>
          </tr>
        </table>

        <div style="display:flex; justify-content:center; gap:10px; margin-top:16px;">
          <button type="button" id="exSubmit"
                  style="min-width:120px; height:38px; border:0; background:#000000; color:#fff; font-weight:300;">êµí™˜ì‹ ì²­</button>
          <button type="button" id="exCancel"
                  style="min-width:120px; height:38px; border:0; background:#ccc; color:#fff;">ì·¨ì†Œ</button>
        </div>
      </div>
    </div>

    <button class="sr-only" id="exchangeSentinel">ë</button>
  </div>
</div>
    <script>
        // ===== êµí™˜ì‹ ì²­ ëª¨ë‹¬ ì œì–´ =====
        const exModal     = document.getElementById('exchangeModal');
        const exBackdrop  = document.getElementById('exchangeModalBackdrop');
        const exClose     = document.getElementById('exClose');
        const exCancel    = document.getElementById('exCancel');
        const exSubmit    = document.getElementById('exSubmit');
        const exSentinel  = document.getElementById('exchangeSentinel');

        function exSetText(id, v){ const el=document.getElementById(id); if(el) el.textContent=v; }
        function exSetSrc(id, v){ const el=document.getElementById(id); if(el) el.src=v; }
        // === ê³µí†µ ì´ë¯¸ì§€ ê²½ë¡œ ì²˜ë¦¬ ===
        function resolveImageUrl(imgPath) {
            if (!imgPath) return `${ctxPath}/images/no_image.jpg`;
            if (imgPath.startsWith('http')) return imgPath;
            return `${ctxPath}/${imgPath.replace(/^\/+/, '')}`;
        }




        async function openExchangeModal(fromBtn){
            const productBlock = fromBtn.closest('div');
            const orderItemId = fromBtn.dataset.orderItemId;
            const userId = document.getElementById('userData')?.dataset.userId || null;
            // âœ… ë²„íŠ¼ì—ì„œ ì§ì ‘ img ì¶”ì 
            const thumb = productBlock?.querySelector('img')?.getAttribute('src') ||
                fromBtn.dataset.productImg ||
                '/NICHIYA/images/no_image.jpg';

            exSetSrc('exThumb', thumb);

            console.log("ğŸ§© êµí™˜ ë²„íŠ¼ í´ë¦­ë¨:", orderItemId, "í˜„ì¬ userId:", userId);

            try {
                // âœ… ë°±ì—”ë“œì—ì„œ ìƒí’ˆ ìƒì„¸ ì¡°íšŒ
                const res = await fetch(`${ctxPath}/api/mypage/exchange/item/${orderItemId}`);
                if (!res.ok) throw new Error('ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                const data = await res.json();

                console.log("ğŸ“¦ [DEBUG] DBì¡°íšŒ ê²°ê³¼:", data);

                // âœ… ëª¨ë‹¬ ë°ì´í„° ë°”ì¸ë”©
                exSetText('exDate', data.ORDER_DATE);
                exSetText('exOrderNo', data.ORDER_CODE);
                exSetText('exSeller', `(ì£¼) ${data.COMPANY_NAME}`);
                exSetText('exName', data.PRODUCT_NAME);
                exSetText('exQty', `ìˆ˜ëŸ‰ : ${data.QUANTITY}ê°œ`);
                exSetText('exPrice', `${Number(data.ORIGINAL_PRICE).toLocaleString()}ì›`);
                exSetText('exStatus', data.ORDER_STATUS);
                exSetSrc('exThumb', resolveImageUrl(data.url) || '/NICHIYA/images/no_image.jpg');


                const exPayEl = document.getElementById('exPay');
                const discount = Number(data.DISCOUNT_PRICE) < 0 ? data.DISCOUNT_PRICE : `-${data.DISCOUNT_PRICE}`;
                const total = Number(data.PAID_PRICE).toLocaleString();

                exPayEl.innerHTML = `
            <div style="display:flex; margin-bottom:5px;">
                <div>íŒë§¤ê°€</div><div style="margin-left:auto;">${Number(data.ORIGINAL_PRICE).toLocaleString()}ì›</div>
            </div>
            <div style="display:flex; margin-bottom:28px;">
                <div>í• ì¸</div><div style="margin-left:auto;">${discount}ì›</div>
            </div>
            <div style="display:flex;">
                <div>ê²°ì œê¸ˆì•¡</div><div style="margin-left:auto; font-weight:800;">${total}ì›</div>
            </div>
        `;

                // ì…ë ¥ ì´ˆê¸°í™”
                document.querySelectorAll('input[name="exType"]').forEach(r=> r.checked=false);
                document.getElementById('exReason').value = '';
                document.getElementById('exFile1').value = '';
                document.getElementById('exFile1Name').textContent = 'ì„ íƒëœ íŒŒì¼ ì—†ìŒ';

                // âœ… ëª¨ë‹¬ ì˜¤í”ˆ
                exModal.classList.add('is-open');
                exBackdrop.classList.add('is-open');
                exModal.setAttribute('aria-hidden', 'false');
                exModal.querySelector('.modal-dialog').focus();
                document.body.style.overflow = 'hidden';

                // âœ… dataset ì €ì¥
                const exNameEl = document.getElementById('exName');
                if (exNameEl) exNameEl.dataset.orderItemId = orderItemId;

            } catch (err) {
                console.error("âŒ [DEBUG] êµí™˜ ëª¨ë‹¬ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
                alert("ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
        }

        // ====== ë‹«ê¸° ======
        function closeExchangeModal(){
            exModal.classList.remove('is-open');
            exBackdrop.classList.remove('is-open');
            exModal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
        }

        // ====== ì´ë²¤íŠ¸ ======
        document.addEventListener('click', (e)=>{
            const btn = e.target.closest('.exchange-btn');
            if(!btn) return;
            e.preventDefault();
            openExchangeModal(btn);
        });
        exClose.addEventListener('click', closeExchangeModal);
        exCancel.addEventListener('click', closeExchangeModal);
        exBackdrop.addEventListener('click', closeExchangeModal);
        document.addEventListener('keydown', (e)=>{
            if (e.key === 'Escape' && exModal.classList.contains('is-open')) closeExchangeModal();
        });

        // íŒŒì¼ëª… í‘œì‹œ
        document.getElementById('exFile1').addEventListener('change', function(){
            const nameSpan = document.getElementById('exFile1Name');
            nameSpan.textContent = this.files?.length ? this.files[0].name : 'ì„ íƒëœ íŒŒì¼ ì—†ìŒ';
        });

        // ====== ì œì¶œ ======
        exSubmit.addEventListener('click', async () => {
            const type = document.querySelector('input[name="exType"]:checked')?.value || '';
            const reason = document.getElementById('exReason').value.trim();
            if (!type) return alert('êµí™˜ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            if (reason.length < 10) return alert('ì‚¬ìœ ë¥¼ ìµœì†Œ 10ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');

            const userId = document.getElementById('userData')?.dataset.userId || null;
            const orderItemId = document.getElementById('exName')?.dataset.orderItemId;
            if (!orderItemId) return alert('ìƒí’ˆ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

            const formData = new FormData();
            formData.append("user_id", Number(userId));
            formData.append("order_item_id", orderItemId);
            formData.append("reason_text", reason);
            formData.append("desired_option", type);
            formData.append("reason_code", "ETC");
            formData.append("status", "REQUESTED");

            const fileInput = document.getElementById('exFile1');
            if (fileInput.files.length > 0) {
                formData.append("evidence_urls", fileInput.files[0]);
            }

            console.log("ğŸ“¤ [DEBUG] FormData ë‚´ìš©:", Array.from(formData.entries()));

            try {
                const res = await fetch(`${ctxPath}/api/mypage/exchange`, { method: 'POST', body: formData });
                if (!res.ok) throw new Error('ì„œë²„ ì˜¤ë¥˜');
                alert('êµí™˜ì‹ ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
                closeExchangeModal();
            } catch (err) {
                console.error("âŒ [DEBUG] êµí™˜ì‹ ì²­ ì‹¤íŒ¨:", err);
                alert("êµí™˜ì‹ ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        });
    </script>
  <!-- ì£¼ë¬¸ ìƒì„¸ ë§ˆì´í˜ì´ì§€_ë©”ì¸#8-->
    <!-- êµ¬ë§¤í™•ì • js-->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.addEventListener('click', (e) => {
                const btn = e.target.closest('.confirm-purchase');
                if (!btn) return;

                const orderId = btn.dataset.orderId;
                if (!orderId) {
                    console.warn('âš ï¸ data-order-id ì†ì„± ì—†ìŒ');
                    return;
                }

                // âœ… ê°™ì€ ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ê°€ì§„ ëª¨ë“  êµ¬ë§¤í™•ì • ë²„íŠ¼ ì°¾ê¸°
                const sameOrderConfirmBtns = document.querySelectorAll(`.confirm-purchase[data-order-id="${orderId}"]`);

                sameOrderConfirmBtns.forEach(confirmBtn => {
                    // âœ… í•´ë‹¹ í–‰(tr) ì°¾ê¸°
                    const row = confirmBtn.closest('tr');

                    // âœ… êµí™˜/ë°˜í’ˆ ë²„íŠ¼ ì°¾ê¸°
                    const exchangeBtns = row.querySelectorAll('.exchange-btn');
                    const returnBtns = row.querySelectorAll('.return-btn');

                    // âœ… êµ¬ë§¤í™•ì • ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                    confirmBtn.textContent = 'êµ¬ë§¤í™•ì •ì™„ë£Œ';
                    confirmBtn.style.backgroundColor = '#ccc';
                    confirmBtn.style.color = '#fff';
                    confirmBtn.style.cursor = 'default';
                    confirmBtn.disabled = true;

                    // âœ… êµí™˜/ë°˜í’ˆ ë²„íŠ¼ ë¹„í™œì„±í™”
                    [...exchangeBtns, ...returnBtns].forEach(x => {
                        if (x) {
                            x.disabled = true;
                            x.style.opacity = '0.4';
                            x.style.cursor = 'not-allowed';
                        }
                    });
                });

                console.log(`âœ… ì£¼ë¬¸ë²ˆí˜¸ ${orderId}ì˜ ëª¨ë“  ìƒí’ˆì´ êµ¬ë§¤í™•ì • ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            });
        });
    </script>
</body>
</html>