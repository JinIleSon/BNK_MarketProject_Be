<div th:replace="~{admin/_header.html}"></div>

<main style="display: flex; justify-content: center; border-top:1px solid #e2e2e2;">
    <div>
        <aside class="euro-nav" aria-label="관리자 사이드 메뉴" style="">
            <section class="euro-nav__group">
                <h4 class="euro-nav__title" style="">환경설정</h4>
                <ul class="euro-nav__list">
                    <li class="euro-nav__item"><a href="#">기본설정</a></li>
                    <li class="euro-nav__item"><a href="#">배너관리</a></li>
                    <li class="euro-nav__item"><a href="#">약관관리</a></li>
                    <li class="euro-nav__item"><a href="#">카테고리</a></li>
                    <li class="euro-nav__item"><a href="#">버전관리</a></li>
                </ul>
            </section>

            <section class="euro-nav__group">
                <h4 class="euro-nav__title" style="">상점관리</h4>
                <ul class="euro-nav__list">
                    <li class="euro-nav__item"><a th:href="@{/admin/shop/list}">상점목록</a></li>
                    <li class="euro-nav__item"><a th:href="@{/admin/sales/list}">매출현황</a></li>
                </ul>
            </section>

            <section class="euro-nav__group">
                <h4 class="euro-nav__title" style="">회원관리</h4>
                <ul class="euro-nav__list">
                    <li class="euro-nav__item is-active"><a th:href="@{/admin/member/list}">회원목록</a></li>
                    <li class="euro-nav__item"><a th:href="@{/admin/point/list}">포인트관리</a></li>
                </ul>
            </section>

            <section class="euro-nav__group">
                <h4 class="euro-nav__title" style="">상품관리</h4>
                <ul class="euro-nav__list">
                    <li class="euro-nav__item"><a th:href="@{/admin/product/list}">상품목록</a></li>
                    <li class="euro-nav__item"><a th:href="@{/admin/productReg/list}">상품등록</a></li>
                </ul>
            </section>

            <section class="euro-nav__group">
                <h4 class="euro-nav__title" style="">주문관리</h4>
                <ul class="euro-nav__list">
                    <li class="euro-nav__item"><a th:href="@{/admin/order/list}">주문현황</a></li>
                    <li class="euro-nav__item"><a th:href="@{/admin/delivery/list}">배송현황</a></li>
                </ul>
            </section>

            <section class="euro-nav__group">
                <h4 class="euro-nav__title" style="">쿠폰관리</h4>
                <ul class="euro-nav__list">
                    <li class="euro-nav__item"><a th:href="@{/admin/coupon/list}">쿠폰목록</a></li>
                    <li class="euro-nav__item"><a th:href="@{/admin/couponsnow/list}">쿠폰발급현황</a></li>
                </ul>
            </section>

            <section class="euro-nav__group">
                <h4 class="euro-nav__title" style="">고객센터</h4>
                <ul class="euro-nav__list">
                    <li class="euro-nav__item"><a th:href="@{/admin/announcement/list}">공지사항</a></li>
                    <li class="euro-nav__item"><a th:href="@{/admin/FAQ/list}">자주묻는질문</a></li>
                    <li class="euro-nav__item"><a th:href="@{/admin/inquiry/list}">문의하기</a></li>
                    <li class="euro-nav__item"><a th:href="@{/admin/employ/list}">채용하기</a></li>
                </ul>
            </section>
        </aside>
    </div>
    <div style="border-left:1px solid #e2e2e2;"></div>
    <!-- 오른쪽 콘텐츠 영역 -->
    <div style="margin-left:40px; width:900px; height:1000px; border:none; padding:20px; box-sizing:border-box; font-family:'Noto Sans KR', sans-serif;">

        <!-- 제목 + 경로 -->
        <div style="display: flex;">
            <div style="font-size: 20px; font-weight: 800; margin-top:16px; margin-bottom:5px;">회원목록</div>
            <div style="margin-left: auto; margin-top:auto; margin-bottom:4px;font-size: 12px;">HOME > 회원관리 > <span style="font-weight: 800;">회원목록</span></div>
        </div>
        <hr style="border:none; border-top:1px solid gray; margin-top:0px;">
        <div style="padding-left:10px;">
            <div style="display: flex; align-items: center; margin-top: 25px; margin-bottom:20px;">
                <form th:action="@{/admin/member/search}" method="get" style="display: flex; ">
                    <select name="searchType" id="" style="width:82px; height:28px; padding-left:5px; margin-right:3px; border:1px solid #bfbfbf; font-size: 10px !important;">
                        <option value="userId">아이디</option>
                        <option value="name">이름</option>
                        <option value="email">이메일</option>
                        <option value="phone">휴대폰</option>
                    </select>
                    <input type="text" name="keyword" placeholder="키워드입력" style="width:140px; height:28px; padding-left:10px; margin-right:3px; border:1px solid #bfbfbf; font-size: 10px !important;">
                    <input type="submit" value="검색" style="width:50px; height:28px; color:white; background-color: black; border:none; font-size: 12px !important;">
                </form>
            </div>

            <!-- 2. 테이블 -->
            <table style="width:100%; border-collapse:collapse; text-align:center; font-size:14px;">
                <thead>
                <tr style="border-top:2px solid #000; border-bottom:1px solid #ccc; background:#fafafa; height:60px;">
                    <th style="width:41px; padding:8px;"><input type="checkbox"></th>
                    <th style="width:32px;">번호</th>
                    <th style="width:85px;">아이디</th>
                    <th style="width:47px;">이름</th>
                    <th style="width:32px;">성별</th>
                    <th style="width:89px;">등급</th>
                    <th style="width:51px;">포인트</th>
                    <th style="width:165px;">이메일</th>
                    <th style="width:112px;">휴대폰</th>
                    <th style="width:85px;">가입일</th>
                    <th style="width:32px;">상태</th>
                    <th>관리</th>
                </tr>
                </thead>
                <tbody>
                <tr style="border-bottom:1px solid #e2e2e2; height:70px;vertical-align: middle;"
                    th:each="admin, stat:${pageResponseDTO.dtoList}"
                    th:attr="
                              data-id=${admin.id},
                              data-user-id=${admin.userId},
                              data-name=${admin.rep},
                              data-gender=${admin.gender},
                              data-grade=${admin.grade},
                              data-email=${admin.email},
                              data-tel=${admin.phone},
                              data-created-at=${admin.created_at},
                              data-look=${admin.look}
                            ">
                    <td><input type="checkbox"></td>
                    <td>[[${pageResponseDTO.startNo - stat.index}]]</td>
                    <td th:text="${admin.userId}">xxx...</td>
                    <td th:text="${admin.rep}">정우성</td>
                    <td th:text="${admin.gender}">M</td>
                    <td >
                        <select style="height: 30px; border: 1px solid #e2e2e2;">
                            <option th:selected="${admin.grade} == 'VVIP'">VVIP</option>
                            <option th:selected="${admin.grade} == 'VIP'">VIP</option>
                            <option th:selected="${admin.grade} == 'GOLD'">GOLD</option>
                            <option th:selected="${admin.grade} == 'SILVER'">SILVER</option>
                            <option th:selected="${admin.grade} == 'FAMILY'">FAMILY</option>
                        </select>
                    </td>
                    <td th:text="${admin.point}">15,000</td>
                    <td th:text="${admin.email}">xxxxx@...</td>
                    <td th:text="${admin.phone}">010-1234-1001</td>
                    <td th:utext="${#strings.replace(admin.created_at, ' ', '<br>')}">0000-00-00 00:00:00</td>
                    <td><span style="color:green; font-weight:500;" th:text="${admin.look}"
                              th:style="${admin.look == '정상' ? 'color:green;' :
                  (admin.look == '중지' ? 'color:red;' : 'color:#555;')}">정상</span></td>
                    <td>
                        <a th:href="@{/admin/onemember/detail(user_id=${admin.userId})}" class="openModalLink">수정</a> |
                        <a href="#" class="openModalLink">중지</a>

                        <div id="shopModal" class="modal">
                            <div class="modal-content" style="text-align: left">
                                <div class="modal-header">
                                    <h2>회원수정</h2>
                                    <span class="close">&times;</span>
                                </div>
                                <div class="modal-body">
                                    <form th:action="@{/admin/onemember/detail}" method="post">
                                        <input type="hidden" name="id">
                                        <table class="edit-table">
                                            <tbody>
                                            <tr>
                                                <th>아이디</th>
                                                <td><input type="text" name="userId" readonly></td>
                                            </tr>
                                            <tr>
                                                <th>이름</th>
                                                <td><input type="text" name="name"></td>
                                            </tr>
                                            <tr>
                                                <th>성별</th>
                                                <td>
                                                    <label class="radio-label">
                                                        <input type="radio" name="gender" value="M" checked>
                                                        <span class="radio-custom"></span> 남
                                                    </label>
                                                    <label class="radio-label" style="margin-left:20px;">
                                                        <input type="radio" name="gender" value="F">
                                                        <span class="radio-custom"></span> 여
                                                    </label>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>등급</th>
                                                <td>
                                                    <input type="text" name="grade" readonly>
                                                    <span style="color:#666; font-size:13px;">등급 수정은 회원 목록에서 선택수정 가능</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>상태</th>
                                                <td><input type="text" name="look" readonly></td>
                                            </tr>
                                            <tr>
                                                <th>EMAIL</th>
                                                <td><input type="email" name="email"></td>
                                            </tr>
                                            <tr>
                                                <th>휴대폰</th>
                                                <td><input type="text" name="tel"></td>
                                            </tr>
                                            <tr>
                                                <th>우편번호</th>
                                                <td>
                                                    <input type="text" name="zipcode" style="width:150px; display:inline-block;">
                                                    <button type="button" style="margin-left:6px;">검색</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>기본주소</th>
                                                <td><input type="text" name="address1"></td>
                                            </tr>
                                            <tr>
                                                <th>상세주소</th>
                                                <td><input type="text" name="address2"></td>
                                            </tr>
                                            <tr>
                                                <th>가입일</th>
                                                <td><input type="text" name="createdAt" readonly></td>
                                            </tr>
                                            <tr>
                                                <th>최근로그인날짜</th>
                                                <td><input type="text" name="updatedAt" readonly></td>
                                            </tr>
                                            <tr>
                                                <th>기타</th>
                                                <td><textarea name="content" placeholder="회원에 대한 기타 정보 입력"></textarea></td>
                                            </tr>
                                            </tbody>
                                        </table>
                                        <div style="text-align:center; margin-top:20px;">
                                            <button type="submit" class="btn-submit" style="cursor:pointer;">수정하기</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>

            <!-- 3. 하단 버튼 영역 -->
            <div style="display: flex; margin-top:25px;">
                <button id="openModalBtn"
                        style="cursor:pointer;border:none; background-color: black; color:white; font-size: 10px; font-weight: 300; height:25px; width:62px;">
                    선택수정
                </button>
            </div>
            <div style=" height: 100px; margin-top:40px; display: flex; justify-content: center;">
                <input th:if="${pageResponseDTO.prev}"
                       th:onclick="|location.href='@{/admin/member/search(pg=${pageResponseDTO.start - 1}, searchType=${pageResponseDTO.searchType}, keyword=${pageResponseDTO.keyword})}'|"
                       type="button" class="prev-page" value="< 이전">

                <th:block th:if="${pageResponseDTO.end >= pageResponseDTO.start}"
                          th:each="num:${#numbers.sequence(pageResponseDTO.start, pageResponseDTO.end)}">
                    <input th:onclick="|location.href='@{/admin/member/search(pg=${num}, searchType=${pageResponseDTO.searchType}, keyword=${pageResponseDTO.keyword})}'|"
                           th:class="${num == pageResponseDTO.pg ? 'current' : 'num'}"
                           type="button"
                           th:value="${num}" />
                </th:block>

                <input th:if="${pageResponseDTO.next}"
                       th:onclick="|location.href='@{/admin/member/search(pg=${pageResponseDTO.end + 1}, searchType=${pageResponseDTO.searchType}, keyword=${pageResponseDTO.keyword})}'|"
                       type="button" class="next-page" value="다음 >" style="">
            </div>
        </div>
    </div>
    </div>
    <style>
        .current{
            border:1px solid #333;
            background-color: #333;
            color: white;
            height: 30px;
            width: 30px;
            margin-right:7px;
            line-height:1;
        }
        .num {
            cursor: pointer;
            border:1px solid #ddd;
            color: #555;
            height: 30px;
            width: 30px;
            margin-right:7px;
            line-height:1;
        }
    </style>
</main>



<style>
    .modal { display:none; position:fixed; z-index:2000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
    .modal-content { background:#fff; width:650px; padding:20px; border-radius:0px; box-shadow:0 4px 12px rgba(0,0,0,0.2); }
    .modal-header { display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #ddd; margin-bottom:15px; }
    .modal-header .close { font-size:22px; font-weight:bold; cursor:pointer; }
    .edit-table { width:100%; border-collapse:collapse; }
    .edit-table th { width:120px; text-align:left; padding:8px; background:#f9f9f9; font-weight:500; }
    .edit-table td { padding:8px; }
    .edit-table input, .edit-table textarea, .edit-table select {
        width:100%; padding:6px 8px; border:1px solid #aaa; border-radius:0px; font-size:14px;
    }
    .edit-table textarea { height:60px; resize:none; }
    .btn-submit {
        background:black; color:#fff; border:none; padding:10px 20px; font-size:15px; border-radius:0px; cursor:pointer;
    }

    /* === 라디오 버튼 커스텀 === */
    .radio-label input[type="radio"] { display: none; }
    .radio-custom {
        width: 18px; height: 18px;
        border: 2px solid #777;
        border-radius: 50%;
        display: inline-block;
        vertical-align: middle;
        margin-right: 6px;
        position: relative;
        cursor: pointer;
    }
    .radio-label input[type="radio"]:checked + .radio-custom {
        border-color: #444;
        background-color: #32527B;   /* 파란색 원 */
        box-shadow: inset 0 0 0 4px #fff; /* 안쪽 흰 원 효과 */
    }
</style>


<style>
    .euro-nav__list {
        max-height: 0;                /* 기본은 접힘 */
        overflow: hidden;             /* 안 보이게 */
        transition: max-height 0.15s ease;
    }

    .euro-nav__group.open .euro-nav__list {
        max-height: 500px;            /* 펼쳐졌을 때 (충분히 크게 설정) */
    }
</style>
<!-- 컨텍스트패스/URL 조립 유틸 -->
<script th:inline="javascript">
    // 예: "/" 또는 "/bnk"
    const CTX = /*[[@{/}]]*/ '/';
    const cp = (p) => (CTX.endsWith('/') ? CTX.slice(0, -1) : CTX) + p;
</script>
<script>
    // 유틸: 모달 input/textarea 셀렉터
    const $ = (sel, root=document) => root.querySelector(sel);

    document.addEventListener('click', async (e) => {
        const a = e.target.closest('.openModalLink');
        if (!a) return;
        e.preventDefault();

        // 1) 행의 기본 데이터(admin) 읽기
        const tr = a.closest('tr');
        const admin = {
            id:         tr.dataset.id || '',
            userId:     tr.dataset.userId || '',
            name:       tr.dataset.name || '',
            gender:     tr.dataset.gender || '',
            grade:      tr.dataset.grade || '',
            email:      tr.dataset.email || '',
            tel:        tr.dataset.tel || '',
            createdAt:  tr.dataset.createdAt || '',
            look:       tr.dataset.look || ''
        };

        if (!admin.userId) return;

        // 2) Ajax로 상세 DTO(detail) 받아오기
        let detail = {};
        try {
            const url = cp('/admin/onemember/detail') + `?user_id=${encodeURIComponent(admin.userId)}`;
            const res = await fetch(url);
            if (res.ok) detail = await res.json();
        } catch (err) {
            console.error(err);
        }

        // 3) 모달 열기
        const modal = document.getElementById('shopModal');
        modal.style.display = 'flex';

        // 4) 모달에 데이터 주입 (admin 우선, detail이 있으면 덮어쓰기)
        //    createdAt/updatedAt은 문자열이면 그대로, LocalDateTime이면 포맷해서 넣기
        const setVal = (sel, val) => { const el = $(sel, modal); if (el) el.value = (val ?? ''); };

        // 기본(리스트) 데이터
        setVal('input[name="id"]', admin.id);
        setVal('input[name="userId"]', admin.userId);
        setVal('input[name="name"]',   admin.name);
        setVal('input[name="email"]',  admin.email);
        setVal('input[name="tel"]',    admin.tel);
        setVal('input[name="grade"]',  admin.grade);
        setVal('input[name="createdAt"]', admin.createdAt);
        setVal('input[name="look"]',   admin.look);

        // 성별 라디오
        const sex = admin.gender || detail.gender || '';
        const sexInput = modal.querySelector(`input[name="gender"][value="${sex}"]`);
        if (sexInput) sexInput.checked = true;

        // 상세(DTO) 데이터 덮어쓰기
        setVal('input[name="zipcode"]',  detail.zipcode);
        setVal('input[name="address1"]', detail.address1);
        setVal('input[name="address2"]', detail.address2);
        setVal('textarea[name="content"]', detail.content);

        // 날짜(상세에 더 신뢰되는 값이 있으면 덮어쓰자)
        setVal('input[name="updatedAt"]', detail.updated_at || detail.updatedAt);

        // 닫기 버튼 & 배경 닫기
        const closeBtn = modal.querySelector('.close');
        closeBtn.onclick = () => modal.style.display = 'none';
        window.addEventListener('click', (evt) => {
            if (evt.target === modal) modal.style.display = 'none';
        }, { once:true });
    });
    // ===== 선택수정 모달 =====
    const modal = document.getElementById("shopModal");
    const openModalBtn = document.getElementById("openModalBtn");
    const closeModalBtn = document.querySelector(".modal .close");

    // 열기
    openModalBtn.addEventListener("click", () => {
        modal.style.display = "flex";
    });

    // 닫기(X)
    closeModalBtn.addEventListener("click", () => {
        modal.style.display = "none";
    });

    // 배경 클릭 시 닫기
    window.addEventListener("click", (e) => {
        if (e.target === modal) {
            modal.style.display = "none";
        }
    });
</script>
<style>
    .euro-nav__list {
        max-height: 0;                /* 기본은 접힘 */
        overflow: hidden;             /* 안 보이게 */
        transition: max-height 0.15s ease;
    }

    .euro-nav__group.open .euro-nav__list {
        max-height: 500px;            /* 펼쳐졌을 때 (충분히 크게 설정) */
    }
</style>
<script>
    // 아코디언: 클릭 시 높이를 실제 내용 높이로 애니메이션
    document.querySelectorAll('.euro-nav__title').forEach(title => {
        title.style.cursor = 'pointer'; // 클릭 가능 시각화(선택)
        title.addEventListener('click', () => {
            const group = title.parentElement;
            const list  = group.querySelector('.euro-nav__list');

            const isOpen = group.classList.contains('open');

            if (isOpen) {
                // 닫기: 현재 높이를 고정 -> 0으로
                list.style.maxHeight = list.scrollHeight + 'px';
                // 강제 리플로우로 트랜지션 시작점 확정
                list.offsetHeight;
                list.style.maxHeight = '0px';
                group.classList.remove('open');
            } else {
                // 열기: 0 -> 내용 높이
                group.classList.add('open');
                list.style.maxHeight = list.scrollHeight + 'px';

                // 애니메이션 끝나면 inline max-height 제거(자연스런 레이아웃)
                const onEnd = (e) => {
                    if (e.propertyName === 'max-height') {
                        list.style.maxHeight = 'none';
                        list.removeEventListener('transitionend', onEnd);
                    }
                };
                list.addEventListener('transitionend', onEnd);
            }
        });
    });

    const groups = document.querySelectorAll('.euro-nav__group');
    document.querySelectorAll('.euro-nav__title').forEach(title => {
        title.addEventListener('click', () => {
            groups.forEach(g => {
                if (g !== title.parentElement && g.classList.contains('open')) {
                    const l = g.querySelector('.euro-nav__list');
                    l.style.maxHeight = l.scrollHeight + 'px';
                    l.offsetHeight;
                    l.style.maxHeight = '0px';
                    g.classList.remove('open');
                }
            });
        }, {capture:true});
    });

</script>
<div th:replace="~{admin/_footer.html}"></div>