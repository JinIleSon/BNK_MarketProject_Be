<div th:replace="~{admin/_noneStickyHeader.html}"></div>

    <main style="border-top:1px solid #e2e2e2; display: flex; justify-content: center; ">
        <div>
            <aside class="euro-nav" aria-label="관리자 사이드 메뉴" style="">
                <section class="euro-nav__group">
                    <h4 class="euro-nav__title" style="">환경설정</h4>
                    <ul class="euro-nav__list">
                        <li class="euro-nav__item"><a href="#">기본설정</a></li>
                        <li class="euro-nav__item"><a href="#">배너관리</a></li>
                        <li class="euro-nav__item"><a href="#">약관관리</a></li>
                        <li class="euro-nav__item"><a href="#">카테고리</a></li>
                        <li class="euro-nav__item"><a href="#">버전관리</a></li>
                    </ul>
                </section>

                <section class="euro-nav__group">
                    <h4 class="euro-nav__title" style="">상점관리</h4>
                    <ul class="euro-nav__list">
                        <li class="euro-nav__item"><a th:href="@{/admin/shop/list}">상점목록</a></li>
                        <li class="euro-nav__item"><a th:href="@{/admin/sales/list}">매출현황</a></li>
                    </ul>
                </section>

                <section class="euro-nav__group">
                    <h4 class="euro-nav__title" style="">회원관리</h4>
                    <ul class="euro-nav__list">
                        <li class="euro-nav__item"><a th:href="@{/admin/member/list}">회원목록</a></li>
                        <li class="euro-nav__item"><a th:href="@{/admin/point/list}">포인트관리</a></li>
                    </ul>
                </section>

                <section class="euro-nav__group">
                    <h4 class="euro-nav__title" style="">상품관리</h4>
                    <ul class="euro-nav__list">
                        <li class="euro-nav__item is-active"><a th:href="@{/admin/product/list}">상품목록</a></li>
                        <li class="euro-nav__item"><a th:href="@{/admin/productReg/list}">상품등록</a></li>
                    </ul>
                </section>

                <section class="euro-nav__group">
                    <h4 class="euro-nav__title" style="">주문관리</h4>
                    <ul class="euro-nav__list">
                        <li class="euro-nav__item"><a th:href="@{/admin/order/list}">주문현황</a></li>
                        <li class="euro-nav__item"><a th:href="@{/admin/delivery/list}">배송현황</a></li>
                    </ul>
                </section>

                <section class="euro-nav__group">
                    <h4 class="euro-nav__title" style="">쿠폰관리</h4>
                    <ul class="euro-nav__list">
                        <li class="euro-nav__item"><a th:href="@{/admin/coupon/list}">쿠폰목록</a></li>
                        <li class="euro-nav__item"><a th:href="@{/admin/couponsnow/list}">쿠폰발급현황</a></li>
                    </ul>
                </section>

                <section class="euro-nav__group">
                    <h4 class="euro-nav__title" style="">고객센터</h4>
                    <ul class="euro-nav__list">
                        <li class="euro-nav__item"><a th:href="@{/admin/announcement/list}">공지사항</a></li>
                        <li class="euro-nav__item"><a th:href="@{/admin/FAQ/list}">자주묻는질문</a></li>
                        <li class="euro-nav__item"><a th:href="@{/admin/inquiry/list}">문의하기</a></li>
                        <li class="euro-nav__item"><a th:href="@{/admin/employ/list}">채용하기</a></li>
                    </ul>
                </section>
            </aside>
        </div>
        <div style="width:940px; border-left:1px solid #e2e2e2;">
            <div style="margin-left:60px;">
                <div style="display: flex;">
                    <div style="font-size: 20px; font-weight: 800; margin-top:16px; margin-bottom:5px;">상품목록</div>
                    <div style="margin-left: auto; margin-top:auto; margin-bottom:4px;font-size: 12px;">HOME > 상품관리 > <span style="font-weight: 800;">상품목록</span></div>
                </div>
                <hr style="border:none; border-top:1px solid gray; margin-top:0px;">
                <div style="padding-left:10px;">
                <div style="display: flex; align-items: center; margin-top: 25px; margin-bottom:20px;">
                    <form th:action="@{/admin/product/search}" method="get" style="display: flex; ">
                        <select name="searchType" id="" style="width:82px; height:28px; padding-left:5px; margin-right:3px; border:1px solid #bfbfbf; font-size: 10px !important;">
                            <option value="product_name">상품명</option>
                            <option value="product_code">상품코드</option>
                            <option value="name">판매자</option>
                        </select>
                        <input type="text" name="keyword" placeholder="키워드입력" style="width:140px; height:28px; padding-left:10px; margin-right:3px; border:1px solid #bfbfbf; font-size: 10px !important;">
                        <input type="submit" value="검색" style="width:50px; height:28px; color:white; background-color: black; border:none; font-size: 12px !important;">
                    </form>
                </div>
                <table style="border-collapse: collapse; width:100%; font-size:12px; text-align: center; ">
                    <tr style="border-top:1px solid gray; height:50px; border-bottom:1px solid #e2e2e2;">
                        <th style="width:37px;"><input type="checkbox"></th>
                        <th style="width:72px;">사진</th>
                        <th style="width:105px;">상품코드</th>
                        <th style="width:96px;">상품명</th>
                        <th style="width:85px;">판매가격</th>
                        <th style="width:65px;">할인가</th>
                        <th style="width:65px;">포인트</th>
                        <th style="width:53px;">재고</th>
                        <th style="width:98px;">판매자</th>
                        <th style="width:45px;">조회</th>
                        <th style="width:119px;">관리</th>
                    </tr>
                    <tr style="border-bottom:1px solid #e2e2e2; height:70px;vertical-align: middle;"
                    th:each="admin, stat:${pageResponseDTO.dtoList}">
                        <td><input class="chk" th:value="${admin.id}" type="checkbox"></td>
                        <td style="padding-left:9px;">
                            <div style="width: 60px;         /* 고정 너비 */
                                          height: 60px;        /* 고정 높이 */
                                          overflow: hidden;    /* 영역 밖은 잘라냄 */
                                          display: flex;
                                          justify-content: center;
                                          align-items: center;">
                            <img th:src="@{/{p}(p=${
                                                #strings.isEmpty(#strings.trim(admin.url))
                                                  ? 'images/no-image.png'
                                                  : (#strings.startsWith(#strings.trim(admin.url), '/')
                                                        ? #strings.substring(#strings.trim(admin.url), 1)
                                                        : #strings.trim(admin.url))
                                            })}" alt=""
                                          style="width: 100%;
                                                  height: 100%;
                                                  object-fit: cover;   /* 공간을 꽉 채우되 넘치면 잘림 */
                                                  vertical-align: middle;">
                            </div>
                        </td>
                        <td th:text="${admin.product_code}"></td>
                        <td th:text="${admin.product_name}">상품명 #1</td>
                        <td th:text="${admin.price}">32,000</td>
                        <td th:text="${admin.discount}">10%</td>
                        <td th:text="${admin.point}">320</td>
                        <td th:text="${admin.stock}">1,000</td>
                        <td th:text="${admin.user_name}">(주)다파라</td>
                        <td th:text="${admin.hits}">120</td>
                        <td>
                            <form th:action="@{/admin/productReg/delete}" method="post"
                            onsubmit="return confirm('정말로 삭제하시겠습니까?');">
                                <input type="hidden" name="product_code" th:value="${admin.product_code}">
                                <button type="submit" style="cursor:pointer;border:none; background: white;">[삭제]</button>
                            </form>
                        </td>
                    </tr>
                </table>
                <div style="display: flex; margin-top:25px;">
                    <button type="button" id="deleteSelectedBtn"
                            style="cursor:pointer;border:none; background-color: #760c0c; color:white; font-size: 10px; font-weight: 300; height:25px; width:62px;">선택삭제</button>
                    <button th:onclick="|location.href='@{/admin/productReg/list}'|"
                            style="cursor:pointer;margin-left:auto; border:none; background-color: black; color:white; font-size: 10px; font-weight: 300; height:25px; width:62px;">상품등록</button>
                </div>
                    <div style=" height: 100px; margin-top:40px; display: flex; justify-content: center;">
                        <input th:if="${pageResponseDTO.prev}"
                               th:onclick="|location.href='@{/admin/product/list(pg=${pageResponseDTO.start - 1})}'|"
                               type="button" class="prev-page" value="< 이전">

                        <th:block th:each="num:${#numbers.sequence(pageResponseDTO.start, pageResponseDTO.end)}">
                            <input th:onclick="|location.href='@{/admin/product/list(pg=${num})}'|"
                                   th:class="${num == pageResponseDTO.pg ? 'current' : 'num'}"
                                   type="button"
                                   th:value="${num}" />
                        </th:block>

                        <input th:if="${pageResponseDTO.next}"
                               th:onclick="|location.href='@{/admin/product/list(pg=${pageResponseDTO.end + 1})}'|"
                               type="button" class="next-page" value="다음 >" style="">
                    </div>
            </div>
        </div>
        </div>
    </main>
<script th:inline="javascript">
    // 서버가 알아서 컨텍스트 경로를 붙여 완전한 URL로 바꿔줍니다.
    const DELETE_URL = /*[[@{/admin/product/delete}]]*/ "/admin/product/delete";

    document.getElementById("deleteSelectedBtn").addEventListener("click", function () {
        const checked = Array.from(document.querySelectorAll(".chk:checked")).map(chk => Number(chk.value));
        if (checked.length === 0) { alert("삭제할 상점을 선택하세요."); return; }
        if (!confirm(`${checked.length}개의 상점을 삭제하시겠습니까?`)) return;

        const csrfToken  = document.querySelector('meta[name="_csrf"]')?.content;
        const csrfHeader = document.querySelector('meta[name="_csrf_header"]')?.content || 'X-CSRF-TOKEN';

        const headers = { "Content-Type": "application/json" };
        if (csrfToken) headers[csrfHeader] = csrfToken;

        fetch(DELETE_URL, {   // ← 하드코딩 대신 DELETE_URL 사용
            method: "POST",
            headers,
            body: JSON.stringify(checked)
        })
            .then(async res => {
                const body = await res.text();
                if (!res.ok) throw new Error(`status=${res.status}, body=${body}`);
                alert("삭제가 완료되었습니다.");
                location.reload();
            })
            .catch(err => {
                console.error("[DELETE ERROR]", err);
                alert("삭제 중 오류가 발생했습니다.\n" + String(err));
            });
    });
</script>
    <style>
        .current{
            border:1px solid #333;
            background-color: #333;
            color: white;
            height: 30px;
            width: 30px;
            margin-right:7px;
            line-height:1;
        }
        .num {
            cursor: pointer;
            border:1px solid #ddd;
            color: #555;
            height: 30px;
            width: 30px;
            margin-right:7px;
            line-height:1;
        }
        .euro-nav__list {
            max-height: 0;                /* 기본은 접힘 */
            overflow: hidden;             /* 안 보이게 */
            transition: max-height 0.15s ease;
        }

            .euro-nav__group.open .euro-nav__list {
            max-height: 500px;            /* 펼쳐졌을 때 (충분히 크게 설정) */
        }
    </style>
    <script>
        // 아코디언: 클릭 시 높이를 실제 내용 높이로 애니메이션
  document.querySelectorAll('.euro-nav__title').forEach(title => {
    title.style.cursor = 'pointer'; // 클릭 가능 시각화(선택)
    title.addEventListener('click', () => {
      const group = title.parentElement;
      const list  = group.querySelector('.euro-nav__list');

      const isOpen = group.classList.contains('open');

      if (isOpen) {
        // 닫기: 현재 높이를 고정 -> 0으로
        list.style.maxHeight = list.scrollHeight + 'px';
        // 강제 리플로우로 트랜지션 시작점 확정
        list.offsetHeight; 
        list.style.maxHeight = '0px';
        group.classList.remove('open');
      } else {
        // 열기: 0 -> 내용 높이
        group.classList.add('open');
        list.style.maxHeight = list.scrollHeight + 'px';

        // 애니메이션 끝나면 inline max-height 제거(자연스런 레이아웃)
        const onEnd = (e) => {
          if (e.propertyName === 'max-height') {
            list.style.maxHeight = 'none';
            list.removeEventListener('transitionend', onEnd);
          }
        };
        list.addEventListener('transitionend', onEnd);
      }
    });
  });

  const groups = document.querySelectorAll('.euro-nav__group');
  document.querySelectorAll('.euro-nav__title').forEach(title => {
    title.addEventListener('click', () => {
      groups.forEach(g => {
        if (g !== title.parentElement && g.classList.contains('open')) {
          const l = g.querySelector('.euro-nav__list');
          l.style.maxHeight = l.scrollHeight + 'px';
          l.offsetHeight;
          l.style.maxHeight = '0px';
          g.classList.remove('open');
        }
      });
    }, {capture:true});
  });
  
    </script>
<div th:replace="~{admin/_footer.html}"></div>