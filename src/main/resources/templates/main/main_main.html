<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="ctx" content="/NICHIYA/">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MainPage</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- ① 폰트 로드 (헤드에 추가) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:opsz,wght@6..96,400;500&family=Noto+Serif+KR:wght@300;400&display=swap" rel="stylesheet">

    <style>
        html, body { height:100%; margin:0; }

        /* Hero 레이아웃 */
        .hero{
            position:relative;
            width:100vw;
            height:100vh;
            overflow:hidden;
            margin:0 auto;
        }

        /* 패널 */
        .panel{
            position:absolute; inset:0;
            opacity:0; transform: translateY(40px);
            transition: transform 600ms ease, opacity 600ms ease;
            pointer-events:none;
        }
        .panel.active{
            opacity:1; transform: translateY(0);
            pointer-events:auto;
        }

        /* 하단 텍스트 탭 */
        .hero-tabs{
            position:absolute; left:50%; bottom:24px;
            transform:translateX(-50%);
            display:flex; gap:28px; flex-wrap:wrap;
            align-items:center; justify-content:center;
            padding:8px 16px;
            z-index:20;
        }
        .hero-tabs .tab{
            background:none; border:none;
            color:#fff; mix-blend-mode:normal;
            font-family:'Bodoni Moda','Noto Serif KR',serif;
            font-weight:400; letter-spacing:.04em;
            text-transform:uppercase;
            cursor:pointer;
            opacity:.7;
        }
        .hero-tabs .tab.active{ opacity:1; font-weight:600; }
        .hero-tabs .tab:focus-visible{ outline:1px solid #fff; }

        /* 슬라이더  */
        .main-slider{ position:relative; width:100%; height:100%; }
        .viewport{ width:100%; height:100%; overflow:hidden; }
        .main-slides{
            display:flex; align-items:center;
            gap:0;
            height:100%;
            transition: transform 600ms ease;
        }
        .main-slides img{
            flex:0 0 100%;
            width:100%; height:100%;
            object-fit:cover;
        }


        /* 좌우 버튼 */
        button.prev, button.next{
            position:absolute; top:50%; transform:translateY(-50%);
            width:60px; height:60px; background:none; border:none; cursor:pointer; z-index:10;
        }
        button.prev{ left:16px; } button.next{ right:16px; }
        button.prev::before, button.next::before{
            content:''; display:inline-block; width:12px; height:12px;
            border-top:1px solid #fff; border-right:1px solid #fff;
        }
        button.prev::before{ transform:rotate(-135deg); }
        button.next::before{ transform:rotate(45deg); }

        /* 반응형 */
        @media (max-width: 768px){
            .hero{ height:80vh; }
            .viewport{ width:90vw; height:60vh; }
            .hero-tabs{ gap:18px; bottom:16px; }
        }
    </style>
</head>
<body>
<div th:replace="~{main/header.html}"></div>

<main>
    <!-- HERO -->
    <section class="hero">
        <!-- 패널: The New -->
        <div class="panel active" id="panel-new">
            <div class="main-slider">
                <button class="prev"></button>
                <div class="viewport">
                    <div class="main-slides">
                        <a th:each="p : ${newList}" th:href="@{'/product/views?id=' + ${p.id}}">
                            <img th:with="path=${#strings.startsWith(p.url,'/') ? #strings.substring(p.url,1) : p.url}"
                                 th:src="@{/{path}(path=${path})}"
                                 th:alt="${'new-' + p.id}">
                        </a>
                    </div>
                </div>
                <button class="next"></button>
            </div>
        </div>

        <!-- 패널: Best Seller (상위 5) -->
        <div class="panel" id="panel-best">
            <div class="main-slider">
                <button class="prev"></button>
                <div class="viewport">
                    <div class="main-slides">
                        <a th:each="p : ${bestList}" th:href="@{'/product/views?id=' + ${p.id}}">
                            <img th:with="path=${#strings.startsWith(p.url,'/') ? #strings.substring(p.url,1) : p.url}"
                                 th:src="@{/{path}(path=${path})}"
                                 th:alt="${'best-' + p.id}">
                        </a>
                    </div>
                </div>
                <button class="next"></button>
            </div>
        </div>

        <!-- 패널: Hit Products -->
        <div class="panel" id="panel-hit">
            <div class="main-slider">
                <button class="prev"></button>
                <div class="viewport">
                    <div class="main-slides">
                        <a th:each="p : ${hitList}" th:href="@{'/product/views?id=' + ${p.id}}">
                            <img th:with="path=${#strings.startsWith(p.url,'/') ? #strings.substring(p.url,1) : p.url}"
                                 th:src="@{/{path}(path=${path})}"
                                 th:alt="${'hit-' + p.id}">
                        </a>
                    </div>
                </div>
                <button class="next"></button>
            </div>
        </div>

        <!-- 패널: Recommend -->
        <div class="panel" id="panel-reco">
            <div class="main-slider">
                <button class="prev"></button>
                <div class="viewport">
                    <div class="main-slides">
                        <a th:each="p : ${recoList}" th:href="@{'/product/views?id=' + ${p.id}}">
                            <img th:with="path=${#strings.startsWith(p.url,'/') ? #strings.substring(p.url,1) : p.url}"
                                 th:src="@{/{path}(path=${path})}"
                                 th:alt="${'reco-' + p.id}">
                        </a>
                    </div>
                </div>
                <button class="next"></button>
            </div>
        </div>

        <!-- 패널: Discount -->
        <div class="panel" id="panel-discount">
            <div class="main-slider">
                <button class="prev"></button>
                <div class="viewport">
                    <div class="main-slides">
                        <a th:each="p : ${discountList}" th:href="@{'/product/views?id=' + ${p.id}}">
                            <img th:with="path=${#strings.startsWith(p.url,'/') ? #strings.substring(p.url,1) : p.url}"
                                 th:src="@{/{path}(path=${path})}"
                                 th:alt="${'discount-' + p.id}">
                        </a>
                    </div>
                </div>
                <button class="next"></button>
            </div>
        </div>

        <!-- 하단 텍스트 탭 -->
        <nav class="hero-tabs" aria-label="메인 카테고리">
            <button class="tab active" data-target="#panel-new">The New</button>
            <button class="tab" data-target="#panel-best">Best Seller</button>
            <button class="tab" data-target="#panel-hit">Hit Products</button>
            <button class="tab" data-target="#panel-reco">Recommend</button>
            <button class="tab" data-target="#panel-discount">Discount</button>
        </nav>
    </section>
</main>

<!--main 푸시-->
<div id="footer"></div>
<!--슬라이드-->
<script>
    document.querySelectorAll('.main-slider').forEach((slider) => {
        const slides = slider.querySelector('.main-slides');
        const viewport = slider.querySelector('.viewport');

        let index = 0;
        const items = Array.from(slides.children); // <a> 단위를 슬라이드로
        let prevBtn = slider.querySelector('.prev');
        let nextBtn = slider.querySelector('.next');
        const total = items.length;

        function update() {
            const width = viewport.clientWidth;
            slides.style.transform = `translateX(-${index * width}px)`;
        }

        // 각 슬라이드 폭 고정
        items.forEach(el => {
            el.style.flex = '0 0 100%';
        });

        nextBtn?.addEventListener('click', () => { index = (index + 1) % total; update(); });
        prevBtn?.addEventListener('click', () => { index = (index - 1 + total) % total; update(); });

        window.addEventListener('resize', update);
        update();
    });
</script>
<script>
    /* 탭으로 패널 전환 */
    (() => {
        const tabs   = [...document.querySelectorAll('.hero-tabs .tab')];
        const panels = tabs
            .map(t => document.querySelector(t.dataset.target))
            .filter(Boolean);

        function setActive(nextIdx){
            tabs.forEach((t,i)=> t.classList.toggle('active', i===nextIdx));
            panels.forEach((p,i)=> p.classList.toggle('active', i===nextIdx));
        }

        tabs.forEach((tab,i)=>{
            tab.addEventListener('click', () => setActive(i));
            tab.addEventListener('keydown', (e) => {
                if(e.key==='Enter' || e.key===' '){ e.preventDefault(); setActive(i); }
            });
        });

        /* 초기 상태 */
        setActive(0);
    })();
</script>
<div th:replace="~{main/footer.html}"></div>
</body>
</html>