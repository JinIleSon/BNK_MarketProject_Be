    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:opsz,wght@6..96,400;500&family=Noto+Serif+KR:wght@300;400&display=swap" rel="stylesheet">
    <style>
        html{ scrollbar-gutter: stable; }
        .icon-btn {
            background:none; border:1px solid #000; cursor:pointer;
            width:40px; height:40px; display:grid; place-items:center;
        }

        /* 1) 스크림(배경) - 화면 전체 덮음 + 블러 */
        .overlay {
            position: fixed; inset: 0;
            background: rgba(255,255,255,0.28);      /* 반투명이어야 blur 보임 */
            backdrop-filter: blur(1px);
            -webkit-backdrop-filter: blur(1px); /* 사파리용 */
            opacity: 0; 
            pointer-events: none;
            transition: opacity .25s ease;
            z-index: 1000;
        }
        .overlay.open { opacity: 1; pointer-events: auto; }

        /* 2) 왼쪽에서 나오는 패널 */
        .overlay__panel {
            position: absolute; top:0; left:0;
            width: 50vw;                 /* 화면 절반 */
            max-width: 900px;            /*(선택) 최대 폭 제한 */
            height: 100%;
            background: white;         /* 패널 자체는 불투명해도 OK */
            transform: translateX(-100%); /* 화면 밖에서 시작 */
            transition: transform .35s ease;
            will-change: transform;
            display: flex; flex-direction: column;
        }
        .overlay.open .overlay__panel { transform: translateX(0); }

        /* 상단 닫기 버튼과 로고 영역 */
        .overlay__top {
            display:flex; align-items:center; gap:24px;
            padding:20px;
        }
        .overlay__close {
            background:none; border:1px solid; width:100px; height:50px; cursor:pointer;
            position:relative;
            border:none;
            margin-left:0.3%;
        }
        .overlay__close::before,
        .overlay__close::after{
            content:""; position:absolute; left:15px; right:10px; top:25px; height:2px; background:#000;
        }
        .overlay__close::before{ transform:rotate(45deg); }
        .overlay__close::after { transform:rotate(-45deg); }

        /* 메뉴 그리드 */
        .overlay__menu {
            display:grid; grid-template-columns: 180px auto; gap:24px;
            padding:40px 20px; font-size:16px;
        }
        .overlay__menu a {
            text-decoration:none; color:#000; display:block; padding:8px 0;
        }
        .overlay__menu strong { font-weight:700; }
        /* Header Sticky 및 background 적용 */
        :root{
            --glass-bg: rgba(255,255,255,.55); /* 호버 시 배경 투명도 */
            --glass-blur: 8px;                 /* 블러 정도 */
        }
        *{ box-sizing: border-box; }
        body{ margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
        a{ color:inherit; text-decoration:none; }
        ul{ margin:0; padding:0; list-style:none; }

        /* ===== 헤더 (처음엔 투명, hover 시 반투명) ===== */
        .site-header{
            position: sticky;      /* 스크롤해도 상단 고정 */
            top: 0;
            z-index: 900;          /* 오버레이(1000)보다 낮게 */
        }
        .site-header::before{
            content:"";
            position:absolute; inset:0;
            background: rgba(255,255,255,0);            /* 기본 완전 투명 */
            transition: background 0.4s ease;
            z-index: -1;
            pointer-events: none;                        /* 클릭 방해 금지 */
        }
        .site-header:hover::before{
            background: rgba(255,255,255,0.7);                /* 마우스 올리면 반투명 */
        }
        .site-header .inner{
            position: relative; z-index: 1;             /* ::before 아래로 깔리게 */
            display:flex; align-items:center; gap:24px;
            padding: 16px 24px;
            border-bottom: 1px solid #000;              /* 필요 없으면 제거 */
        }
         .title-didone{
            text-align:center;
            font-family: 'Bodoni Moda','Didot','Bodoni 72','Times New Roman',serif;
            margin-left:45px;
            font-weight:400;                 
            letter-spacing:.02em;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .title-didone.ko{font-family: 'Noto Serif KR','Bodoni Moda',serif; font-weight:300;}
        /* 왼쪽 대분류 활성화 */
        .overlay__menu a[data-cat].is-active {
            font-weight: 700; text-decoration: underline;
        }
        /* 오른쪽 소분류 활성화 */
        .menu-grid a.is-current {
            text-decoration: underline;
            font-weight: 700;
        }
        /* ========== Overlay Category: underline only ========== */

        /* 좌측 대분류: 기본은 밑줄 0 → 호버/포커스 시 차오름 */
        .overlay__menu a[data-cat]{
            position: relative;
            display: inline-block;
            color:#111;
            text-decoration: none;
            background: linear-gradient(currentColor,currentColor) left bottom / 0 1px no-repeat;
            transition: background-size .25s ease;
        }

        /* 활성 대분류(클릭된 항목)는 밑줄 유지 */
        .overlay__menu a[data-cat].is-active{
            background-size: 100% 1px;
            font-weight: 700;                 /* 기존 표시 방식은 유지 */
        }

        /* 호버/키보드 포커스 시 밑줄이 왼→오로 채워짐 */
        .overlay__menu a[data-cat]:hover,
        .overlay__menu a[data-cat]:focus-visible{
            background-size: 100% 1px;
            outline: none;
        }

        /* 우측 소분류 링크도 동일한 밑줄 모션만 적용 */
        .menu-grid a, .menu-grid li a{
            position: relative;
            display: inline-block;
            padding: 6px 0;
            color:#111;
            text-decoration: none;
            background: linear-gradient(currentColor,currentColor) left bottom / 0 1px no-repeat;
            transition: background-size .25s ease;
        }

        /* 소분류: 현재 카테고리 강조 */
        .menu-grid a.is-current{
            background-size: 100% 1px;
            font-weight: 700;
        }

        /* 호버/포커스 시 밑줄만 */
        .menu-grid a:hover,
        .menu-grid a:focus-visible{
            background-size: 100% 1px;
            outline: none;
        }
        /* 밑줄 위치(아래에서 얼마나 띄울지) */
        :root{ --underline-offset: 6px; } /* ↑ 값만 조절해서 미세 조정(3~8px 권장) */

        /* 좌측 대분류 + 우측 소분류 공통 */
        .overlay__menu a[data-cat],
        .menu-grid a, .menu-grid li a{
            background-position: left calc(100% - var(--underline-offset));
            /* 기존 background-size 전환(hover)은 그대로 둡니다 */
        }

        /* 좌측 대분류 */
        .overlay__menu a[data-cat].is-active,
        .overlay__menu a[data-cat].is-active:hover,
        .overlay__menu a[data-cat].is-active:focus-visible{
            font-weight: 700;
            text-decoration: none !important;   /* 초기 스타일의 underline 제거 */
            background: none !important;        /* 우리가 만든 gradient-underline 제거 */
        }

        /* 우측 소분류 */
        .menu-grid a.is-current,
        .menu-grid a.is-current:hover,
        .menu-grid a.is-current:focus-visible{
            font-weight: 700;
            text-decoration: none !important;
            background: none !important;
        }
    </style>
    <html xmlns:th="http://www.thymeleaf.org"
          xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <header class="site-header">
        <div style="margin-left:2%; width:98%; box-sizing: border-box; margin-top:2%; display:flex; height:230px;">
            <button style="border:none;" id="menuBtn" class="icon-btn" aria-controls="menuOverlay" aria-expanded="false" aria-label="메뉴 열기">
                <svg width="64" height="64" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                    <rect y="12" width="64" height="1" fill="black"/>
                    <rect y="30" width="64" height="1" fill="black"/>
                    <rect y="48" width="64" height="1" fill="black"/>
                </svg>
            </button>
            <div style="margin-left:3%;">
                <a th:href="@{/main/main/page}">
                    <img th:src="@{/images/logo.png}" alt="" style="width:270px;">
                </a>
            </div>
            <div style="margin-top:27px; margin-left:auto; margin-right:3%; flex:1; max-width:40%;">
                <ul style="list-style-type: none; padding: 0; margin:0; display:flex; gap:40px;">
                    <li style="flex:1; min-width: 100px;">
                        <form th:action="@{/product/header/search}" method="get" style="width:100%;">
                            <input type="text" name="keyword" style="background: transparent;border:none; border-bottom:1px solid; padding-bottom:10px; width:80%;" placeholder="검색"
                            onfocus="this.style.outline='none';"
                            onblur="this.style.outline='none';">
                        </form>
                    </li>
                    <!-- ① 비로그인 -->
                    <th:block sec:authorize="isAnonymous()">
                        <li><a th:href="@{/member/login}" style="text-decoration:none; color:black; font-size:14px;">로그인</a></li>
                        <li><a th:href="@{/member/join}"  style="text-decoration:none; color:black; font-size:14px;">회원가입</a></li>
                        <li><a th:href="@{/member/login}" style="text-decoration:none; color:black; font-size:14px;">바스켓백</a></li>
                    </th:block>

                    <!-- ② 로그인(관리자 아님: user/seller) -->
                    <th:block sec:authorize="isAuthenticated() and !hasAuthority('admin')">
                        <li><a th:href="@{/member/logout}"         style="text-decoration:none; color:black; font-size:14px;">로그아웃</a></li>
                        <li><a th:href="@{/mypage/mypage/main}"    style="text-decoration:none; color:black; font-size:14px;">마이페이지</a></li>
                        <li><a th:href="@{/product/cart}"                style="text-decoration:none; color:black; font-size:14px;">바스켓백</a></li>
                    </th:block>

                    <!-- ③ 로그인(관리자) -->
                    <th:block sec:authorize="hasAuthority('admin')">
                        <li><a th:href="@{/admin/admin_main}"      style="text-decoration:none; color:black; font-size:14px;">관리자</a></li>
                        <li><a th:href="@{/member/logout}"         style="text-decoration:none; color:black; font-size:14px;">로그아웃</a></li>
                        <li><a th:href="@{/mypage/mypage/main}"    style="text-decoration:none; color:black; font-size:14px;">마이페이지</a></li>
                        <li><a th:href="@{/product/cart}"                style="text-decoration:none; color:black; font-size:14px;">바스켓백</a></li>
                    </th:block>
                </ul>
            </div>
        </div>
    </header>
    </html>
    <!-- 전체 화면 오버레이 메뉴 -->
  <aside id="menuOverlay" class="overlay" aria-hidden="true">
    <div class="overlay__panel">
        <div class="overlay__top"  style="margin-top:20px;">
            <button id="closeBtn" class="overlay__close" aria-label="메뉴 닫기"></button>
            <div style="font-size:72px; font-weight:800; letter-spacing:-10px; "class="title-didone">NICHIYA</div>
        </div>
        <style>
            /* 우측 서브항목 기본은 숨김 + 페이드 트랜지션 준비 */
            .sub {
                opacity: 0;
                transform: translateY(6px);
                pointer-events: none;
                transition: opacity .28s ease, transform .28s ease;
                display: none; /* 시각·레이아웃 모두 숨김 */
            }
            /* 보여줄 때 */
            .sub.show {
                display: block;
                opacity: 1;
                transform: translateY(0);
                pointer-events: auto;
            }
            /* 오른쪽 컬럼은 패널들을 포개는 '스테이지' */
            #subcol{
                grid-row: span 2;
                height:900px;
                position: relative;          /* 자식 absolute 기준점 */
                padding: 0;                  /* 안쪽 여백은 패널에서 */
            }
            /* 접근성: 현재 선택된 카테고리 표시(선택사항) */
            .overlay__menu a[data-cat].is-active { font-weight: 700; text-decoration: underline; }

            /* 오른쪽 컬럼의 항목은 여백 제거(전역 a padding 무시) */
            #subcol .sub{
                padding:0;
                margin:0;
            }
            /* 패널: 전부 겹쳐 놓고 기본은 숨김 */
            #subcol .panel{
                position: absolute; inset: 0;
                padding: 20px;
                overflow: auto;
                opacity: 0;
                transform: translateY(6px);
                transition: opacity .35s ease, transform .35s ease;
                visibility: hidden;   /* display 대신 visibility */
                pointer-events: none; /* 숨길 때 클릭 방지 */
            }

            /* 보이는 패널 */
            #subcol .panel.show{
                opacity: 1;
                transform: none;
                visibility: visible;
                pointer-events: auto; /* 다시 클릭 가능 */
            }

            /* 예시용 그리드(원하면 커스터마이즈) */
            .menu-grid{
                display: grid;
                grid-template-columns: repeat(2, auto);
                column-gap: 50px;   /* 가로 간격 여기서 조절 */
                row-gap: 6px;      /* 세로 간격(필요시) */
                padding: 0;        /* UL 기본 패딩 제거 */
                margin: 0;         /* UL 기본 마진 제거 */
                justify-content: start; /* 왼쪽 정렬 */
            }
            .menu-grid li{ list-style: none; }
            #header{ display: contents; }
        </style>

        <div style="display: flex; margin-left:20%; margin-top:1%; width:100%;">
            <nav class="overlay__menu" style="width:100%;">
                <div style="padding-top: 31px;">
                    <div>
                        <a href="#" data-cat="fashion" style="margin-bottom: 10px;">패션</a>
                    </div>
                    <div>
                        <a href="#" data-cat="beauty" style="margin-bottom: 10px;">뷰티</a>
                    </div>
                    <div>
                        <a href="#" data-cat="electronics" style="margin-bottom: 10px;">전자제품</a>
                    </div>
                    <div>
                        <a href="#" data-cat="home" style="margin-bottom: 10px;">홈</a>
                    </div>
                    <div>
                        <a href="#" data-cat="leisure" style="margin-bottom: 10px;">레저</a>
                    </div>
                </div>
                <div id="subcol">
                    <!-- 패션 패널 -->
                    <section class="panel" data-key="fashion">
                        <h3>패션</h3>
                        <!-- 이 안은 자유롭게: 그리드/이미지/텍스트 무엇이든 -->
                        <ul class="menu-grid" style="">
                        <li><a th:href="@{/product/list(categoryId=4, sort='recent', pg=1, size=8)}">여성의류</a></li>
                        <li><a th:href="@{/product/list(categoryId=3, sort='recent', pg=1, size=8)}">남성의류</a></li>
                        <li><a th:href="@{/product/list(categoryId=2, sort='recent', pg=1, size=8)}">키즈의류</a></li>
                        <li><a th:href="@{/product/list(categoryId=5, sort='recent', pg=1, size=8)}">스포츠의류</a></li>
                        <!-- … -->
                        </ul>
                    </section>

                    <!-- 디지털 패널 -->
                    <section class="panel" data-key="beauty">
                        <h3>뷰티</h3>
                        <div class="menu-grid">
                        <a th:href="@{/product/list(categoryId=7,  sort='recent', pg=1, size=8)}">화장품</a>
                        <a th:href="@{/product/list(categoryId=8,  sort='recent', pg=1, size=8)}">향수</a>
                        </div>
                    </section>

                    <!-- 식품 패널 -->
                    <section class="panel" data-key="electronics">
                        <h3>전자제품</h3>
                        <div class="menu-grid">
                            <a th:href="@{/product/list(categoryId=10, sort='recent', pg=1, size=8)}">생활기기</a>
                            <a th:href="@{/product/list(categoryId=11, sort='recent', pg=1, size=8)}">음향기기</a>
                        </div>
                    </section>

                    <!-- 홈/문구 패널 -->
                    <section class="panel" data-key="home">
                        <h3>홈</h3>
                        <div class="menu-grid">
                            <a th:href="@{/product/list(categoryId=13, sort='recent', pg=1, size=8)}">대형가구</a>
                            <a th:href="@{/product/list(categoryId=14, sort='recent', pg=1, size=8)}">소형가구</a>
                        </div>
                    </section>

                    <!-- 도서 패널 -->
                    <section class="panel" data-key="leisure">
                        <h3>레저</h3>
                        <div class="menu-grid">
                            <a th:href="@{/product/list(categoryId=16, sort='recent', pg=1, size=8)}">스터프</a>
                            <a th:href="@{/product/list(categoryId=17, sort='recent', pg=1, size=8)}">탈것</a>
                        </div>
                    </section>
                </div>
                <div style=""></div>
            </nav>
        </div>
    </div>
  </aside>

    <script>
        const body     = document.body;
        const menuBtn  = document.getElementById('menuBtn');
        const closeBtn = document.getElementById('closeBtn');
        const overlay  = document.getElementById('menuOverlay');

        function openMenu(){
            overlay.classList.add('open');
            overlay.setAttribute('aria-hidden', 'false');
            menuBtn.setAttribute('aria-expanded', 'true');
            body.style.overflow = 'hidden';
        }
        function closeMenu(){
            overlay.classList.remove('open');
            overlay.setAttribute('aria-hidden', 'true');
            menuBtn.setAttribute('aria-expanded', 'false');
            body.style.overflow = '';
        }

        menuBtn.addEventListener('click', openMenu);
        closeBtn.addEventListener('click', closeMenu);
        overlay.addEventListener('click', (e) => { if(e.target === overlay) closeMenu(); });
        window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && overlay.classList.contains('open')) closeMenu(); });

        // ===== 카테고리 패널 제어 =====
        const catLinks = document.querySelectorAll('.overlay__menu a[data-cat]');
        const panels   = document.querySelectorAll('#subcol .panel');

        function setActiveCat(target){
            catLinks.forEach(a => a.classList.remove('is-active'));
            if(target) target.classList.add('is-active');
        }
        function showPanel(key){
            panels.forEach(p => p.classList.toggle('show', p.dataset.key === key));
        }

        catLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const key = link.getAttribute('data-cat');
                setActiveCat(link);
                showPanel(key);
            });
        });

        // ========== NEW: categoryId가 있으면 해당 분류/소분류 자동 선택 ==========
        // (1) 서버에서 심어준 categoryId 읽기 (없으면 null)
        const catIdMeta = document.querySelector('meta[name="category-id"]');
        const currentCategoryId = catIdMeta ? Number(catIdMeta.content) : null;

        // (2) categoryId → 대분류 키 매핑
        const catById = {
            2:'fashion', 3:'fashion', 4:'fashion', 5:'fashion',
            7:'beauty',  8:'beauty',
            10:'electronics', 11:'electronics',
            13:'home', 14:'home',
            16:'leisure', 17:'leisure'
        };

        // (3) 대분류/소분류 자동 활성화
        (function initCategoryUI(){
            let defaultKey = 'fashion'; // categoryId가 없을 때 기본
            if(Number.isInteger(currentCategoryId) && catById[currentCategoryId]){
                const key = catById[currentCategoryId];

                // 대분류 활성화 + 패널 오픈
                const leftLink = document.querySelector(`.overlay__menu a[data-cat="${key}"]`);
                setActiveCat(leftLink);
                showPanel(key);

                // 소분류(우측) 강조: 해당 categoryId를 포함하는 링크 찾아 표시
                const subLink = document.querySelector(`#subcol .panel[data-key="${key}"] a[href*="categoryId=${currentCategoryId}"]`);
                if(subLink){
                    subLink.classList.add('is-current');
                }
            } else {
                // 기존 기본 동작
                setActiveCat(document.querySelector('.overlay__menu a[data-cat="fashion"]'));
                showPanel(defaultKey);
            }
        })();
    </script>


