<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>product_complete</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:opsz,wght@6..96,400;500&family=Noto+Serif+KR:wght@300;400&display=swap" rel="stylesheet">
    <style>
        html{ scrollbar-gutter: stable; }
        .icon-btn{ background:none; border:1px solid #000; cursor:pointer; width:40px; height:40px; display:grid; place-items:center; }
        .overlay{ position: fixed; inset:0; background:rgba(255,255,255,.28); backdrop-filter:blur(1px); -webkit-backdrop-filter:blur(1px); opacity:0; pointer-events:none; transition:opacity .25s ease; z-index:1000; }
        .overlay.open{ opacity:1; pointer-events:auto; }
        .overlay__panel{ position:absolute; top:0; left:0; width:50vw; max-width:900px; height:100%; background:#fff; transform:translateX(-100%); transition:transform .35s ease; will-change:transform; display:flex; flex-direction:column; }
        .overlay.open .overlay__panel{ transform:translateX(0); }
        .overlay__top{ display:flex; align-items:center; gap:24px; padding:20px; }
        .overlay__close{ background:none; border:1px solid; width:100px; height:50px; cursor:pointer; position:relative; border:none; margin-left:.3%; }
        .overlay__close::before,.overlay__close::after{ content:""; position:absolute; left:15px; right:10px; top:25px; height:2px; background:#000; }
        .overlay__close::before{ transform:rotate(45deg); } .overlay__close::after{ transform:rotate(-45deg); }
        .overlay__menu{ display:grid; grid-template-columns:180px auto; gap:24px; padding:40px 20px; font-size:16px; }
        .overlay__menu a{ text-decoration:none; color:#000; display:block; padding:8px 0; }
        .overlay__menu strong{ font-weight:700; }
        :root{ --glass-bg:rgba(255,255,255,.55); --glass-blur:8px; }
        *{ box-sizing:border-box; } body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
        a{ color:inherit; text-decoration:none; } ul{ margin:0; padding:0; list-style:none; }
        .site-header{ position:sticky; top:0; z-index:900; }
        .site-header::before{ content:""; position:absolute; inset:0; background:rgba(255,255,255,0); transition:background .4s ease; z-index:-1; pointer-events:none; }
        .site-header:hover::before{ background:rgba(255,255,255,.7); }
        .site-header .inner{ position:relative; z-index:1; display:flex; align-items:center; gap:24px; padding:16px 24px; border-bottom:1px solid #000; }
        footer a{ text-decoration:none; font-weight:300; color:black; }
        .prev-page{ background:#fff; border:none; margin-right:15px; width:50px; height:30px; }
        .next-page{ background:#fff; border:none; margin-left:15px; width:50px; height:30px; margin-right:3px; }
        .title-didone{ text-align:center; font-family:'Bodoni Moda','Didot','Bodoni 72','Times New Roman',serif; margin-left:45px; font-weight:400; letter-spacing:.02em; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
        .title-didone.ko{ font-family:'Noto Serif KR','Bodoni Moda',serif; font-weight:300; }
    </style>
</head>

<body th:object="${order}">
<div th:replace="~{main/header.html}"></div>

<div style="height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center; margin:0 auto;">
    <div style="display:flex;">
        <div style="font-size:18px; margin-right:1200px;"><b>주문완료</b></div>
    </div>
    <hr style="border:none; border-top:1px solid black; margin-bottom:40px; width:100%;">
    <div style="font-size:20px; margin-bottom:8px;">고객님의 주문이 정상적으로 완료되었습니다.</div>
    <div style="margin-bottom:20px;">즐거운 쇼핑이 되셨나요? 항상 고객님을 위한 일야가 되겠습니다.</div>

    <!-- 아이템 테이블 -->
    <div th:with="
         itemsList=${order != null and order.items != null ? order.items : T(java.util.Collections).emptyList()},
         totalDiscount=${order != null and order.summary != null
             ? ((order.summary.discountAmount != null ? order.summary.discountAmount : 0)
                + (order.summary.pointUse != null ? order.summary.pointUse : 0))
             : 0 }">

        <table style="border-collapse:collapse; border:none; width:1270px; text-align:center;">
            <tr style="height:50px; border-top:4px solid black; border-bottom:1px solid #dddddd;">
                <td style="width:50px;"><input type="checkbox" disabled></td>
                <td style="width:450px;">상품명</td>
                <td style="width:92px;">상품금액</td>
                <td style="width:136px;">할인금액</td>
                <td style="width:92px;">수량</td>
                <td style="width:136px;">주문금액</td>
            </tr>

            <!-- 목록 -->
            <th:block th:each="r : ${itemsList}">
                <tr th:if="${r != null}">
                    <td><input type="checkbox" disabled></td>

                    <!-- 상품명/이미지 -->
                    <td style="display:flex;">
                        <div style="margin:10px; width:80px; height:75px; background-color:#dddddd;">
                            <img th:src="${r.url != null} ? @{|/${r.url}|} : @{/images/placeholder.png}"
                                 alt="이미지" style="width:100%; height:100%; object-fit:cover;">
                        </div>
                        <div style="padding-left:18px; display:flex; font-size:14px; align-items:flex-start; justify-content:center; flex-direction:column;">
                            <div style="margin-bottom:6px;" th:text="${r.product_name}">상품명</div>
                            <div style="color:gray; font-size:12px;" th:text="${r.option_name != null ? r.option_name : ''}">옵션</div>
                        </div>
                    </td>

                    <!-- 상품금액(정가 × 수량) -->
                    <td th:text="${#numbers.formatInteger((r.unitPrice != null ? r.unitPrice : 0) * (r.quantity != null ? r.quantity : 0), 3, 'COMMA')}">0</td>

                    <!-- 할인가(수량 반영) -->
                    <td th:text="${
                          (r.unitDiscount != null ? r.unitDiscount : 0) > 0
                          ? '-' + #numbers.formatInteger(T(java.lang.Math).round((r.unitDiscount != null ? r.unitDiscount : 0) * (r.quantity != null ? r.quantity : 0) * 1.0), 3, 'COMMA')
                          : '0'
                        }">-0</td>

                    <!-- 수량 -->
                    <td th:text="${r.quantity != null ? r.quantity : 0}">1</td>

                    <!-- 주문금액(판매가×수량 = lineTotal) -->
                    <td style="color:red;" th:text="${#numbers.formatInteger((r.lineTotal != null ? r.lineTotal : 0), 3, 'COMMA')}">0</td>
                </tr>
            </th:block>

            <!-- 비어있을 때 -->
            <tr th:if="${#lists.isEmpty(itemsList)}">
                <td colspan="6" style="padding:24px;">주문 상품이 없습니다.</td>
            </tr>
        </table>
    </div>

    <!-- 합계 박스 -->
    <div style="border:1px solid #f2f2f2; width:300px; margin-left:970px; height:148px; padding:20px; background-color:#f2f2f2;">
        <div style="padding-left:7px; padding-right:7px;">
            <div style="margin-bottom:6px;">
                <div>총 상품금액
                    <span style="float:right;"
                          th:text="${#numbers.formatInteger(order != null and order.summary != null ? order.summary.subtotalAmount : 0, 3, 'COMMA') + ' 원'}">0 원</span>
                </div>
            </div>
            <div style="margin-bottom:6px;">
                <div>총 할인금액
                    <span style="float:right;"
                          th:text="${'-' + #numbers.formatInteger((order != null and order.summary != null ? ((order.summary.discountAmount != null ? order.summary.discountAmount : 0) + (order.summary.pointUse != null ? order.summary.pointUse : 0)) : 0), 3, 'COMMA') + ' 원'}">-0 원</span>
                </div>
            </div>
            <div style="margin-bottom:6px;">
                <div>배송비
                    <span style="float:right;"
                          th:text="${#numbers.formatInteger(order != null and order.summary != null ? (order.summary.delichar != null ? order.summary.delichar : 0) : 0, 3, 'COMMA') + ' 원'}">0 원</span>
                </div>
            </div>
            <div style="margin-bottom:6px;">
                <div>총 결제금액
                    <span style="float:right; color:red;"
                          th:text="${#numbers.formatInteger(order != null and order.summary != null ? order.summary.totalPayable : 0, 3, 'COMMA') + ' 원'}">0 원</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 주문정보 -->
    <div style="display:flex; margin-top:14px; margin-bottom:10px;">
        <div style="font-size:18px; margin-right:1200px;"><b>주문정보</b></div>
    </div>
    <div style="border-top:4px solid; width:1270px; display:flex; border-bottom:1px solid #dddddd;">
        <div style="width:150px; padding:17px; background-color:#f2f2f2;">
            <div style="margin-bottom:6px;">주문정보</div>
            <div style="margin-bottom:6px;">결제방법</div>
            <div style="margin-bottom:6px;">주문자</div>
            <div>연락처</div>
        </div>
        <div style="padding-left:19px; display:flex; justify-content:center; flex-direction:column;">
            <div style="margin-bottom:7px;" th:text="*{orderCode} ?: ''">O20251020123456</div>
            <div style="margin-bottom:7px;" th:text="*{payMethod != null ? payMethod : ''}">신용카드</div>
            <div style="margin-bottom:7px;" th:text="*{buyerName != null ? buyerName : ''}">홍길동</div>
            <div style="margin-bottom:4px;" th:text="*{buyerPhone != null ? buyerPhone : ''}">010-1234-1234</div>
        </div>
        <div style="display:flex; align-items:end; margin-left:auto;">
            <div style="width:210px; margin-right:45px; margin-bottom:8px;">
                <span>총 결제금액</span>
                <span style="float:right;">원</span>
                <span style="color:red; float:right;"
                      th:text="${#numbers.formatInteger(order != null and order.summary != null ? order.summary.totalPayable : 0, 3, 'COMMA')}">0</span>
            </div>
        </div>
    </div>

    <!-- 배송정보 -->
    <div style="display:flex; margin-top:14px; margin-bottom:10px;">
        <div style="font-size:18px; margin-right:1200px;"><b>배송정보</b></div>
    </div>
    <div style="border-top:4px solid; width:1270px; display:flex; border-bottom:1px solid #dddddd; margin-bottom:60px;">
        <div style="width:150px; padding:17px; background-color:#f2f2f2;">
            <div style="margin-bottom:6px;">수취인</div>
            <div style="margin-bottom:6px;">연락처</div>
            <div>배송지 주소</div>
        </div>
        <div style="padding-left:19px; display:flex; justify-content:center; flex-direction:column;">
            <!-- 수취인 -->
            <div style="margin-bottom:7px;"
                 th:text="*{shipping != null ? shipping.recipient : ''}">수취인</div>

            <!-- 연락처 -->
            <div style="margin-bottom:7px;"
                 th:text="*{shipping != null ? shipping.delicom : ''}">010-1234-1234</div>

            <!-- 배송지 주소: [#우편번호] 기본주소 + 상세주소 -->
            <div th:text="*{shipping != null ?
                 ((shipping.address  != null ? shipping.address : '') +
                  (shipping.address2 != null ? ' ' + shipping.address2 : ''))
               : ''}">부산 금정구 123-11 10층</div>
        </div>
    </div>
</div>

<div th:replace="~{main/footer.html}"></div>
</body>
</html>
