<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>product_search</title>
    <style>
        /* í˜ì´ì§€ë„¤ì´ì…˜ */
        /* ê²Œì‹œíŒ ì•„ë˜ë²„íŠ¼ ë¶€ë¶„ */
        .prev-page {
            background-color: white;
            border: none;
            margin-right: 15px;
            width: 50px;
            height: 30px;
            cursor: pointer;
        }

        .next-page {
            background-color: white;
            border: none;
            margin-left: 15px;
            width: 50px;
            height: 30px;
            margin-right: 3px;
            cursor: pointer;
        }

        /* ê²Œì‹œíŒ ì•„ë˜ë²„íŠ¼ ë¶€ë¶„ ë */
    </style>
</head>
<body>

<div th:replace="~{main/header.html}"></div>
<main>
    <div style="display: flex;">
        <div style="font-size:18px; margin-left:7.6%;"><b>ìƒí’ˆê²€ìƒ‰ê²°ê³¼</b></div>
    </div>
    <hr style="border:none; border-top:1px solid black; margin-bottom:40px; width:100%;">
    <div style="margin-left:7.5%; width:687px; margin-bottom:30px;">
        <div style=""><span style="font-weight:800; color:#b80000; font-size:20px;"
                            th:text="${query.keyword != null && query.keyword != '' ? query.keyword : 'ì „ì²´'}">ê²€ìƒ‰ì–´</span>
            <span style="font-size:20px; font-weight:800;">ê²€ìƒ‰ê²°ê³¼</span>
            <span>
      ( ì´ :
      <span style="color:red;" th:text="${pageResponseProductDTO.total}">0</span>
      ê±´ )
    </span></div>
        <div style=" display: flex; align-items: center; height:70px;">
            <form method="get" style="display:flex; align-items:center;" th:action="@{/product/search}">
                <input name="keyword" style="border:1px solid #ddd; width:170px; height:32px;" th:value="${query.keyword}"
                       type="text">
                <button style="margin:0 30px; background:#000; color:#fff; border:none; height:34px; width:57px;">ê²€ìƒ‰
                </button>
                <label><input name="searchType" th:checked="${query.searchType}=='name'" type="radio" value="name"> ìƒí’ˆëª…</label>
                <label style="margin-left:10px;"><input name="searchType" th:checked="${query.searchType}=='explain'" type="radio"
                                                        value="explain"> ì„¤ëª…</label>
                <label style="margin-left:10px;"><input name="searchType" th:checked="${query.searchType}=='price'" type="radio"
                                                        value="price"> ê°€ê²©</label>
                <input name="minPrice" placeholder="ìµœì†Œ" style="margin-left:10px; border:1px solid #ddd; width:90px; height:32px;" th:value="${query.minPrice}"
                       type="number">
                <span style="margin:0 6px;">~</span>
                <input name="maxPrice" placeholder="ìµœëŒ€" style="border:1px solid #ddd; width:90px; height:32px;" th:value="${query.maxPrice}"
                       type="number">
            </form>
        </div>
    </div>
    <script>
        document.querySelectorAll(".only-one").forEach((checkbox) => {
            checkbox.addEventListener("change", function () {
                if (this.checked) {
                    document.querySelectorAll(".only-one").forEach((cb) => {
                        if (cb !== this) cb.checked = false;
                    });
                }
            });
        });
    </script>
    <hr style="border:none; border-top:1px solid black;">
    <div style="color:gray; margin-left:7.6%; margin-bottom:30px;">
        <a th:classappend="${sort}=='sales' ? ' active'"
           th:href="@{/product/search(sort='sales',     keyword=${query.keyword}, searchType=${query.searchType}, minPrice=${query.minPrice}, maxPrice=${query.maxPrice}, pg=1, size=${pageResponseProductDTO.size})}">íŒë§¤ë§ì€ìˆœ</a>&nbsp;|&nbsp;

        <a th:classappend="${sort}=='priceAsc' ? ' active'"
           th:href="@{/product/search(sort='priceAsc',  keyword=${query.keyword}, searchType=${query.searchType}, minPrice=${query.minPrice}, maxPrice=${query.maxPrice}, pg=1, size=${pageResponseProductDTO.size})}">ë‚®ì€ê°€ê²©ìˆœ</a>&nbsp;|&nbsp;

        <a th:classappend="${sort}=='priceDesc' ? ' active'"
           th:href="@{/product/search(sort='priceDesc', keyword=${query.keyword}, searchType=${query.searchType}, minPrice=${query.minPrice}, maxPrice=${query.maxPrice}, pg=1, size=${pageResponseProductDTO.size})}">ë†’ì€ê°€ê²©ìˆœ</a>&nbsp;|&nbsp;

        <a th:classappend="${sort}=='rating' ? ' active'"
           th:href="@{/product/search(sort='rating',    keyword=${query.keyword}, searchType=${query.searchType}, minPrice=${query.minPrice}, maxPrice=${query.maxPrice}, pg=1, size=${pageResponseProductDTO.size})}">í‰ì ë†’ì€ìˆœ</a>&nbsp;|&nbsp;

        <a th:classappend="${sort}=='review' ? ' active'"
           th:href="@{/product/search(sort='review',    keyword=${query.keyword}, searchType=${query.searchType}, minPrice=${query.minPrice}, maxPrice=${query.maxPrice}, pg=1, size=${pageResponseProductDTO.size})}">í›„ê¸°ë§ì€ìˆœ</a>&nbsp;|&nbsp;

        <a th:classappend="${sort}=='recent' ? ' active'"
           th:href="@{/product/search(sort='recent',    keyword=${query.keyword}, searchType=${query.searchType}, minPrice=${query.minPrice}, maxPrice=${query.maxPrice}, pg=1, size=${pageResponseProductDTO.size})}">ìµœê·¼ë“±ë¡ìˆœ</a>
    </div>
    <style>.active {
        font-weight: 700;
        text-decoration: underline;
        color: #000;
    }</style>
    <div style="display:flex; gap:80px; justify-content:center; flex-wrap:wrap;">
        <th:block th:each="p : ${pageResponseProductDTO.dtoList}">
            <a th:href="@{/product/views(id=${p.id})}">
                <img style="width:40vw;"
                     th:src="${p.url} != null ? (@{/__${p.url}__}) : @{/images/placeholder.png}">

                <div style="display:flex; justify-content:space-between; align-items:flex-end; width:100%;">
                    <!-- ì¢Œì¸¡: í…ìŠ¤íŠ¸ ì˜ì—­ -->
                    <div style="flex:1; display:flex; flex-direction:column;"
                         th:with="
             orig=${p.price},
             discAmt=${p.discount != null ? p.discount : 0},
             discSafe=${(discAmt > orig) ? orig : discAmt},
             final=${orig - discSafe},
             rate=${orig > 0 ? T(java.lang.Math).round(discSafe * 100.0 / orig) : 0},
             stars=${p.ratingAvg != null ? T(java.lang.Math).round(p.ratingAvg) : 0}
           ">
                        <span style="font-size:18px;" th:text="${p.product_name}">ìƒí’ˆëª…</span>
                        <span style="font-size:10px;" th:text="${p.sub_description}">ì„¤ëª…</span>

                        <!-- ìµœì¢…ê°€ -->
                        <span style="font-size:18px;"
                              th:text="${#numbers.formatInteger(final,3,'COMMA')} + 'ì›'">0ì›</span>

                        <!-- ì›ê°€ + í• ì¸ìœ¨ -->
                        <span style="color:gray;" th:if="${discSafe > 0}">
          <s th:text="${#numbers.formatInteger(orig,3,'COMMA')} + 'ì›'">0ì›</s>
          <font color="red" th:text="' ' + ${rate} + '%â†“'">0%â†“</font>
        </span>

                        <!-- ë³„ì (ë…¸ë€ìƒ‰) + (í‰ê· /ë¦¬ë·°ìˆ˜) -->
                        <span style="color:#ffcc00; font-size:16px; margin-top:5px;" th:if="${p.ratingAvg != null}">
          <span th:each="i : ${#numbers.sequence(1, stars)}">â˜…</span>
          <span style="color:#666; font-size:12px;"
                th:text="' (' + ${#numbers.formatDecimal(p.ratingAvg,1,1)} + ' / ' + ${p.ratingCnt} + ')'"></span>
        </span>
                    </div>

                    <!-- ê°€ìš´ë°: ë°°ì†¡ë¹„/ë¬´ë£Œë°°ì†¡ -->
                    <div style="border:1px solid #778ba3; font-weight:300; width:120px; height:30px;
                  display:flex; justify-content:center; align-items:center; margin-bottom:27px;"
                         th:if="${p.delichar != null}"
                         th:text="${p.delichar == 0 ? 'ë¬´ë£Œë°°ì†¡' :
                     'ë°°ì†¡ë¹„ ' + #numbers.formatInteger(p.delichar,3,'COMMA') + 'ì›'}">
                    </div>

                    <!-- ìš°ì¸¡: íŒë§¤ì ì˜ì—­(ê³ ê°ë§Œì¡±ìš°ìˆ˜) -->
                    <div style="margin-left:auto; display:flex; flex-direction:column;
                  padding-left:65px; margin-bottom:10px; width:200px;">
                        <span>ğŸ íŒë§¤ì</span>
                        <span>ğŸ…ê³ ê°ë§Œì¡±ìš°ìˆ˜</span>
                    </div>
                </div>
            </a>
        </th:block>
    </div>

    <div style="height:100px; margin-top:40px; display:flex; justify-content:center;">
        <input class="prev-page"
               th:if="${pageResponseProductDTO.prev}"
               th:onclick="|location.href='@{/product/search(pg=${pageResponseProductDTO.start - 1}, size=${pageResponseProductDTO.size}, sort=${sort}, keyword=${query.keyword}, searchType=${query.searchType}, minPrice=${query.minPrice}, maxPrice=${query.maxPrice})}'|" type="button" value="< ì´ì „">

        <th:block th:each="num : ${#numbers.sequence(pageResponseProductDTO.start, pageResponseProductDTO.end)}">
            <input th:class="${num == pageResponseProductDTO.pg ? 'current' : 'num'}"
                   th:onclick="|location.href='@{/product/search(pg=${num}, size=${pageResponseProductDTO.size}, sort=${sort}, keyword=${query.keyword}, searchType=${query.searchType}, minPrice=${query.minPrice}, maxPrice=${query.maxPrice})}'|"
                   th:value="${num}" type="button"/>
        </th:block>

        <input class="next-page"
               th:if="${pageResponseProductDTO.next}"
               th:onclick="|location.href='@{/product/search(pg=${pageResponseProductDTO.end + 1}, size=${pageResponseProductDTO.size}, sort=${sort}, keyword=${query.keyword}, searchType=${query.searchType}, minPrice=${query.minPrice}, maxPrice=${query.maxPrice})}'|" type="button" value="ë‹¤ìŒ >">
    </div>
    <style>
        .current {
            border: 1px solid #333;
            background-color: #333;
            color: white;
            height: 30px;
            width: 30px;
            margin-right: 7px;
            line-height: 1;
        }

        .num {
            cursor: pointer;
            border: 1px solid #ddd;
            color: #555;
            height: 30px;
            width: 30px;
            margin-right: 7px;
            line-height: 1;
        }

        .euro-nav__list {
            max-height: 0; /* ê¸°ë³¸ì€ ì ‘í˜ */
            overflow: hidden; /* ì•ˆ ë³´ì´ê²Œ */
            transition: max-height 0.15s ease;
        }

        .euro-nav__group.open .euro-nav__list {
            max-height: 500px; /* í¼ì³ì¡Œì„ ë•Œ (ì¶©ë¶„íˆ í¬ê²Œ ì„¤ì •) */
        }
    </style>
    <div th:replace="~{main/footer.html}"></div>
</main>
</body>
</html>