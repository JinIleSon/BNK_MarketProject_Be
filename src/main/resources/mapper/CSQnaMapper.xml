<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.bnk_marketproject_be.mapper.CSQnaMapper">

    <!-- QnA 목록 -->
    <select id="selectQnaList" resultType="kr.co.bnk_marketproject_be.dto.CSNoticeDTO">
        SELECT *
        FROM BOARD
        WHERE BOARD_TYPE = 'QNA'
        <if test="userId != null and userId != ''">
            AND USER_ID = #{userId}
        </if>
        ORDER BY CREATED_AT DESC
    </select>

    <!-- QnA 상세 -->
    <select id="selectQnaDetail" resultType="kr.co.bnk_marketproject_be.dto.CSNoticeDTO">
        SELECT * FROM BOARD
        WHERE BOARD_TYPE = 'QNA' AND ID = #{id}
    </select>

    <!-- QnA 등록 -->
    <insert id="insertQna" parameterType="kr.co.bnk_marketproject_be.dto.CSNoticeDTO">
        INSERT INTO BOARD (BOARD_TYPE, USER_ID, TITLE, CONTENT, STATUS, CREATED_AT)
        VALUES ('QNA', #{userId}, #{title}, #{content}, '대기', SYSDATE)
    </insert>

    <!-- 관리자 답변 등록 -->
    <update id="updateAnswer" parameterType="kr.co.bnk_marketproject_be.dto.CSNoticeDTO">
        UPDATE BOARD
        SET ANSWER = #{answer},
            STATUS = '완료',
            ANSWERED_AT = SYSDATE
        WHERE ID = #{id}
          AND BOARD_TYPE = 'QNA'
    </update>

</mapper>
